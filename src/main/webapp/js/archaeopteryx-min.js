if(!d3)throw"no d3.js";if(!forester)throw"no forester.js";if(!phyloXml)throw"no phyloxml.js";!function e(){"use strict";function t(e,t){function n(e){return!e.branch_length||e.branch_length<0?0:e.branch_length}_l.parent&&(_l.parent.distToRoot=0),forester.preOrderTraversalAll(_l,function(e){e.distToRoot=(e.parent?e.parent.distToRoot:0)+n(e)});var o=e.map(function(e){return e.distToRoot}),l=d3.scale.linear().domain([0,d3.max(o)]).range([0,t]);return forester.preOrderTraversalAll(_l,function(e){e.y=l(e.distToRoot)}),l}function n(){Tl.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}function o(e,t){var n=Ul.scale();t||(t=-e.y0,t=t*n+Zl/2);var o=0;d3.select("g").transition().duration(750).attr("transform","translate("+t+","+o+")scale("+n+")"),Ul.scale(n),Ul.translate([t,o])}function l(){return Ol.rootOffset+Il.nodeLabelGap+ql*Il.externalNodeFontSize*.8}function a(e,t,n,o,l,a,r,i,s){if(arguments.length<8)throw"expected at least 8 arguments, got "+arguments.length;if(!e||e.length<1)throw"need to have label";var c={};if(c.label=e,t&&(c.description=t),n){if(o)throw"need to have either field or clade property ref";c.field=n}else{if(!o)throw"need to have either field or clade property ref";c.cladePropertyRef=o}if(c.isRegex=l,a){if(r)throw"need to have either mapping or mappingFn";c.mapping=a}else{if(!r)throw"need to have either mapping or mappingFn";if(c.mappingFn=r,i===qo&&r.domain()&&r.range()&&r.domain().length>r.range().length)if(s&&s.domain()&&s.range())c.mappingFn=s,i=Xo;else{var d=o?o:n;console.log(kl+": Ordinal scale mapping for "+e+" ("+d+"): domain > range: "+r.domain().length+" > "+r.range().length)}}return c.scaleType=i,c}function r(e){if(Ml)for(var t in Ml)if(Ml.hasOwnProperty(t)){var n=Ml[t];if(n.label){var o="";if(n.shapes&&Array.isArray(n.shapes)&&n.shapes.length>0){var l=null;n.cladeRef&&e[n.cladeRef]&&forester.setToArray(e[n.cladeRef]).length>0?(l=d3.scale.ordinal().range(n.shapes).domain(forester.setToArray(e[n.cladeRef])),o=qo):n.field&&e[n.field]&&forester.setToArray(e[n.field]).length>0&&(l=d3.scale.ordinal().range(n.shapes).domain(forester.setToArray(e[n.field])),o=qo),l&&d(n.label,n.description,n.field?n.field:null,n.cladeRef?n.cladeRef:null,n.regex,null,l,o)}if(n.colors&&n.cladeRef&&e[n.cladeRef]&&forester.setToArray(e[n.cladeRef]).length>0){var a=null,r=null;if(Array.isArray(n.colors))if(o=Xo,3===n.colors.length)a=d3.scale.linear().range(n.colors).domain(forester.calcMinMeanMaxInSet(e[n.cladeRef]));else{if(2!==n.colors.length)throw"Number of colors has to be either 2 or 3";a=d3.scale.linear().range(n.colors).domain(forester.calcMinMaxInSet(e[n.cladeRef]))}if(Array.isArray(n.colorsAlt))if(3===n.colorsAlt.length)r=d3.scale.linear().range(n.colorsAlt).domain(forester.calcMinMeanMaxInSet(e[n.cladeRef]));else{if(2!==n.colorsAlt.length)throw"Number of colors has to be either 2 or 3";r=d3.scale.linear().range(n.colorsAlt).domain(forester.calcMinMaxInSet(e[n.cladeRef]))}if(forester.isString(n.colors)&&n.colors.length>0)if(o=qo,"category20"===n.colors)a=d3.scale.category20().domain(forester.setToArray(e[n.cladeRef])),za.add("category20");else if("category20b"===n.colors)a=d3.scale.category20b().domain(forester.setToArray(e[n.cladeRef])),za.add("category20b");else if("category20c"===n.colors)a=d3.scale.category20c().domain(forester.setToArray(e[n.cladeRef])),za.add("category20c");else{if("category10"!==n.colors)throw"do not know how to process "+n.colors;a=d3.scale.category10().domain(forester.setToArray(e[n.cladeRef])),za.add("category10")}a&&(u(n.label,n.description,null,n.cladeRef,n.regex,null,a,o,r),s(n.label,n.description,null,n.cladeRef,n.regex,null,a,o,r),c(n.label,n.description,null,n.cladeRef,n.regex,null,a,o,r))}if(n.sizes&&Array.isArray(n.sizes)&&n.sizes.length>0&&n.cladeRef&&e[n.cladeRef]&&forester.setToArray(e[n.cladeRef]).length>0){var f=null,o=Xo;if(3===n.sizes.length)f=d3.scale.linear().range(n.sizes).domain(forester.calcMinMeanMaxInSet(e[n.cladeRef]));else{if(2!==n.sizes.length)throw"Number of sizes has to be either 2 or 3";f=d3.scale.linear().range(n.sizes).domain(forester.calcMinMaxInSet(e[n.cladeRef]))}f&&i(n.label,n.description,null,n.cladeRef,n.regex,null,f,o)}}}}function i(e,t,n,o,l,r,i,s){if(8!=arguments.length)throw"expected 8 arguments, got "+arguments.length;if(ga||(ga={}),ga.nodeSize||(ga.nodeSize={}),ga.nodeSize[e])throw'node size visualization for "'+e+'" already exists';var c=a(e,t,n,o,l,r,i,s);c&&(ga.nodeSize[c.label]=c)}function s(e,t,n,o,l,r,i,s,c){if(arguments.length<8)throw"expected at least 8 arguments, got "+arguments.length;if(ga||(ga={}),ga.nodeFillColor||(ga.nodeFillColor={}),ga.nodeFillColor[e])throw'node fill color visualization for "'+e+'" already exists';var d=a(e,t,n,o,l,r,i,s,c);d&&(ga.nodeFillColor[d.label]=d)}function c(e,t,n,o,l,r,i,s,c){if(arguments.length<8)throw"expected at least 8 arguments, got "+arguments.length;if(ga||(ga={}),ga.nodeBorderColor||(ga.nodeBorderColor={}),ga.nodeBorderColor[e])throw'node border color visualization for "'+e+'" already exists';var d=a(e,t,n,o,l,r,i,s,c);d&&(ga.nodeBorderColor[d.label]=d)}function d(e,t,n,o,l,r,i,s){if(8!=arguments.length)throw"expected 8 arguments, got "+arguments.length;if(ga||(ga={}),ga.nodeShape||(ga.nodeShape={}),ga.nodeShape[e])throw'node shape visualization for "'+e+'" already exists';var c=a(e,t,n,o,l,r,i,s);c&&(ga.nodeShape[c.label]=c)}function u(e,t,n,o,l,r,i,s,c){if(arguments.length<8)throw"expected at least 8 arguments, got "+arguments.length;if(ga||(ga={}),ga.labelColor||(ga.labelColor={}),ga.labelColor[e])throw'label color visualization for "'+e+'" already exists';var d=a(e,t,n,o,l,r,i,s,c);d&&(ga.labelColor[d.label]=d)}function f(){forester.preOrderTraversal(_l,function(e){e.hasVis=void 0})}function h(e){Ll.selectAll("g."+e).remove()}function p(e){Ll.selectAll("g."+e).remove()}function g(e){Ll.selectAll("g."+e).remove()}function m(e,t,n,o,l,a,r){if(!a)throw"legend label is missing";var i=" (gradient)",s=" *",c=l===Xo,d=0;c?(a+=i,d=o.domain().length):o.domain().length>o.range().length&&(a+=s);var u=0,f=10,h=4,p=-1,g=-1.5,m=-.5,y=Ll.selectAll("g."+e).data(o.domain()),v=y.enter().append("g").attr("class",e);v.append("rect").style("cursor","pointer").attr("width",null).attr("height",null).on("click",function(e,t){Oe(o,a,r,e,t)}),v.append("text").attr("class",rl).style("color",Ol.controlsFontColor).style("font-size",Ol.controlsFontSize).style("font-family",Ol.controlsFont).style("font-style","normal").style("font-weight","normal").style("text-decoration","none"),v.append("text").attr("class",il).style("color",Ol.controlsFontColor).style("font-size",Ol.controlsFontSize).style("font-family",Ol.controlsFont).style("font-style","normal").style("font-weight","bold").style("text-decoration","none"),v.append("text").attr("class",sl).style("color",Ol.controlsFontColor).style("font-size",Ol.controlsFontSize).style("font-family",Ol.controlsFont).style("font-style","normal").style("font-weight","bold").style("text-decoration","none");var b=y.transition().duration(0).attr("transform",function(e,o){++u;var l=f,a=t,r=n+o*l;return"translate("+a+","+r+")"});return b.select("rect").attr("width",f).attr("height",f).style("fill",o).style("stroke",o),b.select("text."+rl).attr("x",f+h).attr("y",f-h).text(function(e,t){if(c){if(0===t)return e+" (min)";if(2===d&&1===t||3===d&&2===t)return e+" (max)";if(3===d&&1===t)return F(e,4)+" (mean)"}return e}),b.select("text."+il).attr("x",p).attr("y",g*f).text(function(e,t){if(0===t)return a}),b.select("text."+sl).attr("x",p).attr("y",m*f).text(function(e,t){if(0===t&&r)return r}),y.exit().remove(),u}function y(e,t,n,o,l,a){if(!l)throw"legend label is missing";var r=" *";o.domain().length>o.range().length&&(l+=r);var i=0,s=10,c=4,d=-1,u=-1.5,f=-.5,h=Ll.selectAll("g."+e).data(o.domain()),p=h.enter().append("g").attr("class",e);p.append("path"),p.append("text").attr("class",rl).style("color",Ol.controlsFontColor).style("font-size",Ol.controlsFontSize).style("font-family",Ol.controlsFont).style("font-style","normal").style("font-weight","normal").style("text-decoration","none"),p.append("text").attr("class",il).style("color",Ol.controlsFontColor).style("font-size",Ol.controlsFontSize).style("font-family",Ol.controlsFont).style("font-style","normal").style("font-weight","bold").style("text-decoration","none"),p.append("text").attr("class",sl).style("color",Ol.controlsFontColor).style("font-size",Ol.controlsFontSize).style("font-family",Ol.controlsFont).style("font-style","normal").style("font-weight","bold").style("text-decoration","none");var g=h.transition().duration(200).attr("transform",function(e,o){++i;var l=s,a=t,r=n+o*l;return"translate("+a+","+r+")"}),m=[];return g.select("text."+rl).attr("x",s+c).attr("y",s-c).text(function(e){return m.push(e),e}),g.select("text."+il).attr("x",d).attr("y",u*s).text(function(e,t){if(0===t)return l}),g.select("text."+sl).attr("x",d).attr("y",f*s).text(function(e,t){if(0===t&&a)return a}),g.select("path").attr("transform",function(){return"translate(1,3)"}).attr("d",d3.svg.symbol().size(function(){return 20}).type(function(e,t){return o(m[t])})).style("fill","none").style("stroke",Il.branchColorDefault),h.exit().remove(),i}function v(e,t,n,o,l,a,r){if(!a)throw"legend label is missing";var i=" (range)",s=l===Xo,c=0;s&&(a+=i,c=o.domain().length);var d=0,u=10,f=4,h=-1,p=-1.5,g=-.5,m=Ll.selectAll("g."+e).data(o.domain()),y=m.enter().append("g").attr("class",e);y.append("path"),y.append("text").attr("class",rl).style("color",Ol.controlsFontColor).style("font-size",Ol.controlsFontSize).style("font-family",Ol.controlsFont).style("font-style","normal").style("font-weight","normal").style("text-decoration","none"),y.append("text").attr("class",il).style("color",Ol.controlsFontColor).style("font-size",Ol.controlsFontSize).style("font-family",Ol.controlsFont).style("font-style","normal").style("font-weight","bold").style("text-decoration","none"),y.append("text").attr("class",sl).style("color",Ol.controlsFontColor).style("font-size",Ol.controlsFontSize).style("font-family",Ol.controlsFont).style("font-style","normal").style("font-weight","bold").style("text-decoration","none");var v=m.transition().duration(200).attr("transform",function(e,o){++d;var l=u,a=t,r=n+o*l;return"translate("+a+","+r+")"}),b=[];return v.select("text."+rl).attr("x",u+f).attr("y",u-f).text(function(e,t){if(b.push(e),s){if(0===t)return e+" (min)";if(2===c&&1===t||3===c&&2===t)return e+" (max)";if(3===c&&1===t)return F(e,4)+" (mean)"}return e}),v.select("text."+il).attr("x",h).attr("y",p*u).text(function(e,t){if(0===t)return a}),v.select("text."+sl).attr("x",h).attr("y",g*u).text(function(e,t){if(0===t&&r)return r}),v.select("path").attr("transform",function(){return"translate(1,3)"}).attr("d",d3.svg.symbol().size(function(e,t){var n=Ul.scale();return n*Il.nodeSizeDefault*o(b[t])}).type(function(){return"circle"})).style("fill","none").style("stroke",Il.branchColorDefault),m.exit().remove(),d}function F(e,t){var n=Math.pow(10,t);return(Math.round(e*n+(t>0?1:0)*(Math.sign(e)*(10/Math.pow(100,t))))/n).toFixed(t)}function b(){var e=Il.visualizationsLegendXpos,t=Il.visualizationsLegendYpos,n=0,o=0,l=0;if(Il.visualizationsLegendOrientation===Uo)n=130;else{if(Il.visualizationsLegendOrientation!==Ho)throw"unknown direction for legends "+Il.visualizationsLegendOrientation;o=10,l=40}var a="",r="",i=0,s="";xa&&va[Vo]?(h(Vo),a="Label Color",r=ta,s=ga.labelColor[ta].scaleType,i=m(Vo,e,t,va[Vo],s,a,r),e+=n,t+=i*o+l):h(Vo),xa&&Il.showNodeVisualizations&&va[Po]?(h(Po),a="Node Fill",r=oa,s=ga.nodeFillColor[oa].scaleType,i=m(Po,e,t,va[Po],s,a,r),e+=n,t+=i*o+l):h(Po),xa&&Il.showNodeVisualizations&&va[Io]?(h(Io),a="Node Border",r=la,s=ga.nodeBorderColor[la].scaleType,i=m(Io,e,t,va[Io],s,a,r),e+=n,t+=i*o+l):h(Io),xa&&Il.showNodeVisualizations&&Fa[Oo]?(a="Node Shape",r=na,i=y(Oo,e,t,Fa[Oo],a,r),e+=n,t+=i*o+l):p(Oo),xa&&Il.showNodeVisualizations&&ba[Mo]?(a="Node Size",r=aa,s=ga.nodeSize[aa].scaleType,v(Mo,e,t,ba[Mo],s,a,r)):g(Mo)}function x(e){var t=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],n=null,o=0;if("category20"===e)o=20,n=d3.scale.category20().domain(t);else if("category20b"===e)o=20,n=d3.scale.category20b().domain(t);else if("category20c"===e)o=20,n=d3.scale.category20c().domain(t);else{if("category10"!==e)throw"do not know "+e;o=10,n=d3.scale.category10().domain([0,1,2,3,4,5,6,7,8,9])}for(var l=[],a=0;a<o;++a)l.push(n(a));return l}function w(e,t,n,o,l){Ca={},Ca.targetScale=e,Ca.legendLabel=t,Ca.legendDescription=n,Ca.clickedName=o,Ca.clickedIndex=l,Ca.clickedOrigColor=e(o),wa=!0}function C(){wa=!1,Ca=null,Ll.selectAll("g."+nl).remove()}function z(){var e=["#FFEBEE","#FFCDD2","#EF9A9A","#E57373","#EF5350","#F44336","#E53935","#D32F2F","#C62828","#B71C1C","#FF8A80","#FF5252","#FF1744","#D50000","#FCE4EC","#F8BBD0","#F48FB1","#F06292","#EC407A","#E91E63","#D81B60","#C2185B","#AD1457","#880E4F","#FF80AB","#FF4081","#F50057","#C51162","#F3E5F5","#E1BEE7","#CE93D8","#BA68C8","#AB47BC","#9C27B0","#8E24AA","#7B1FA2","#6A1B9A","#4A148C","#EA80FC","#E040FB","#D500F9","#AA00FF","#EDE7F6","#D1C4E9","#B39DDB","#9575CD","#7E57C2","#673AB7","#5E35B1","#512DA8","#4527A0","#311B92","#B388FF","#7C4DFF","#651FFF","#6200EA","#E8EAF6","#C5CAE9","#9FA8DA","#7986CB","#5C6BC0","#3F51B5","#3949AB","#303F9F","#283593","#1A237E","#8C9EFF","#536DFE","#3D5AFE","#304FFE","#E3F2FD","#BBDEFB","#90CAF9","#64B5F6","#42A5F5","#2196F3","#1E88E5","#1976D2","#1565C0","#0D47A1","#82B1FF","#448AFF","#2979FF","#2962FF","#E1F5FE","#B3E5FC","#81D4FA","#4FC3F7","#29B6F6","#03A9F4","#039BE5","#0288D1","#0277BD","#01579B","#80D8FF","#40C4FF","#00B0FF","#0091EA","#E0F7FA","#B2EBF2","#80DEEA","#4DD0E1","#26C6DA","#00BCD4","#00ACC1","#0097A7","#00838F","#006064","#84FFFF","#18FFFF","#00E5FF","#00B8D4","#E0F2F1","#B2DFDB","#80CBC4","#4DB6AC","#26A69A","#009688","#00897B","#00796B","#00695C","#004D40","#A7FFEB","#64FFDA","#1DE9B6","#00BFA5","#E8F5E9","#C8E6C9","#A5D6A7","#81C784","#66BB6A","#4CAF50","#43A047","#388E3C","#2E7D32","#1B5E20","#B9F6CA","#69F0AE","#00E676","#00C853","#F1F8E9","#DCEDC8","#C5E1A5","#AED581","#9CCC65","#8BC34A","#7CB342","#689F38","#558B2F","#33691E","#CCFF90","#B2FF59","#76FF03","#64DD17","#F9FBE7","#F0F4C3","#E6EE9C","#DCE775","#D4E157","#CDDC39","#C0CA33","#AFB42B","#9E9D24","#827717","#F4FF81","#EEFF41","#C6FF00","#AEEA00","#FFFDE7","#FFF9C4","#FFF59D","#FFF176","#FFEE58","#FFEB3B","#FDD835","#FBC02D","#F9A825","#F57F17","#FFFF8D","#FFFF00","#FFEA00","#FFD600","#FFF8E1","#FFECB3","#FFE082","#FFD54F","#FFCA28","#FFC107","#FFB300","#FFA000","#FF8F00","#FF6F00","#FFE57F","#FFD740","#FFC400","#FFAB00","#FFF3E0","#FFE0B2","#FFCC80","#FFB74D","#FFA726","#FF9800","#FB8C00","#F57C00","#EF6C00","#E65100","#FFD180","#FFAB40","#FF9100","#FF6D00","#FBE9E7","#FFCCBC","#FFAB91","#FF8A65","#FF7043","#FF5722","#F4511E","#E64A19","#D84315","#BF360C","#FF9E80","#FF6E40","#FF3D00","#DD2C00","#EFEBE9","#D7CCC8","#BCAAA4","#A1887F","#8D6E63","#795548","#6D4C41","#5D4037","#4E342E","#3E2723","#FAFAFA","#F5F5F5","#EEEEEE","#E0E0E0","#BDBDBD","#9E9E9E","#757575","#616161","#424242","#212121","#ECEFF1","#CFD8DC","#B0BEC5","#90A4AE","#78909C","#607D8B","#546E7A","#455A64","#37474F","#263238","#FFFFFF","#999999","#000000","#FF0000","#00FF00","#0000FF","#FF00FF","#FFFF00","#00FFFF",Il.backgroundColorDefault];Da=[];for(var t=e.length,n=0;n<t;++n)Da.push(e[n]);za.forEach(function(e){for(var t=x(e),n=t.length,o=0;o<n;++o)Da.push(t[o])})}function D(e){function t(e){function t(e){var t,n;return t=document.createElement("canvas"),t.height=1,t.width=1,n=t.getContext("2d"),n.fillStyle=e,n.fillRect(0,0,1,1),n.getImageData(0,0,1,1).data}function n(e){return("0"+e.toString(16)).slice(-2)}var o,l;return o=t(e),l=[0,1,2].map(function(e){return n(o[e])}).join(""),"#"+l}var n=300,o=20;Da||z();for(var l=-1,a=[],r=0;r<Da.length;++r)a[r]=r,l<0&&t(Da[r])===t(Ca.clickedOrigColor)&&(l=r);var i=d3.scale.linear().domain(a).range(Da),s=14,c=10,d=-1,u=-.5,f=Ll.selectAll("g."+e).data(i.domain()),h=f.enter().append("g").attr("class",e);h.append("rect").style("cursor","pointer").attr("width",null).attr("height",null).on("click",function(e,t){E(i(e))}),h.append("text").attr("class",al).style("color",Ol.controlsFontColor).style("font-size",Ol.controlsFontSize).style("font-family",Ol.controlsFont).style("font-style","normal").style("font-weight","bold").style("text-decoration","none");var p=f.transition().duration(0).attr("transform",function(e,t){t>=234&&(t+=4,t>=248&&(t+=4),t>=262&&(t+=4),t>=276&&(t+=4),t>=290&&(t+=4),t>=304&&(t+=4),t>=318&&(t+=4),t>=332&&(t+=4),t>=346&&(t+=4));var l=n+Math.floor(t/s)*c,a=o+t%s*c;return"translate("+l+","+a+")"});p.select("rect").attr("width",c).attr("height",c).style("fill",i).style("stroke",function(e,t){return t===l?ol:263===t?ll:"#ffffff"}),p.select("text."+al).attr("x",d).attr("y",u*c).text(function(e,t){if(0===t)return"Choose "+Ca.legendLabel.toLowerCase()+" for "+Ca.legendDescription.toLowerCase()+' "'+Ca.clickedName+'":'}),f.exit().remove()}function E(e){var t=ga.labelColor[Ca.legendDescription],n=t.mappingFn,o=t.scaleType,l=null,a=null,r=null;if(o===qo){var i=Ca.targetScale;l=i.domain(),a=[];for(var s=0;s<l.length;++s)r=l[s],r===Ca.clickedName?a[s]=e:a[s]=i(r);n.range(a)}else if(o===Xo){var c=Ca.targetScale;l=c.domain(),a=[];for(var d=0;d<l.length;++d)r=l[d],r===Ca.clickedName?a[d]=e:a[d]=c(r);n.range(a)}S()}function S(e,n,o){e||(e=_l),void 0===n&&(n=$t),o&&o!==!1&&pa||(pa=Zl-l(),pa<1&&(pa=1)),Ol.enableNodeVisualizations&&(b(),wa&&D(nl)),Rl=Rl.size([Ql,pa]),Rl=Rl.separation(function(e,t){return e.parent==t.parent,1}),ha=forester.calcSumOfAllExternalDescendants(_l);var a=forester.calcSumOfExternalDescendants(_l),r=Rl.nodes(_l).reverse(),i=Rl.links(r),s=Il.nodeLabelGap;Il.phylogram===!0&&(Hl=t(forester.getAllExternalNodes(_l),pa)),Il.dynahide&&(ra=0,ia=Math.round(Il.externalNodeFontSize/(.8*Ql/a)),forester.preOrderTraversal(_l,function(e){!e.children&&ia>=2&&++ra%ia!==0?e.hide=!0:e.hide=!1})),rt(),it(),ft(),(Ol.enableNodeVisualizations||Ol.enableBranchVisualizations)&&ht();var c=Tl.selectAll("g.node").data(r,function(e){return e.id||(e.id=++Xl)}),d=c.enter().append("g").attr("class","node").attr("transform",function(){return"translate("+e.y0+","+e.x0+")"}).style("cursor","default").on("click",Rl.clickEvent);d.append("path").attr("d","M0,0"),d.append("circle").attr("class","nodeCircle").attr("r",0),d.append("circle").style("cursor","pointer").style("opacity","0").attr("class","nodeCircleOptions").attr("r",function(e){return e.parent?5:0}),d.append("text").attr("class","extlabel").attr("text-anchor",function(e){return e.children||e._children?"end":"start"}).style("font-family",Il.defaultFont).style("font-style","normal").style("font-weight","normal").style("text-decoration","none").style("fill-opacity",.5),d.append("text").attr("class","bllabel").style("font-family",Il.defaultFont).style("font-style","normal").style("font-weight","normal").style("text-decoration","none").style("fill-opacity",.5),d.append("text").attr("class","conflabel").attr("text-anchor","middle").style("font-family",Il.defaultFont).style("font-style","normal").style("font-weight","normal").style("text-decoration","none"),d.append("text").attr("class","brancheventlabel").attr("text-anchor","middle").style("font-family",Il.defaultFont).style("font-style","normal").style("font-weight","normal").style("text-decoration","none"),d.append("text").attr("class","collapsedText").attr("dy",function(e){return.3*Il.externalNodeFontSize+"px"}).style("font-family",Il.defaultFont).style("font-style","normal").style("font-weight","normal").style("text-decoration","none"),c.select("text.extlabel").style("font-size",function(e){return e.children||e._children?Il.internalNodeFontSize+"px":Il.externalNodeFontSize+"px"}).style("fill",$a).attr("dy",function(e){return e.children||e._children?.3*Il.internalNodeFontSize+"px":.3*Il.externalNodeFontSize+"px"}).attr("x",function(e){return e.children||e._children?-s:Il.phylogram&&Il.alignPhylogram?-Hl(e.distToRoot)+pa+s:s}),c.select("text.bllabel").style("font-size",Il.branchDataFontSize+"px").attr("dy","-.25em").attr("x",function(e){return e.parent?e.parent.y-e.y+1:0}),c.select("text.conflabel").style("font-size",Il.branchDataFontSize+"px").attr("dy",Il.branchDataFontSize).attr("x",function(e){return e.parent?.5*(e.parent.y-e.y):0}),c.select("text.brancheventlabel").style("font-size",Il.branchDataFontSize+"px").attr("dy","-.25em").attr("x",function(e){if(e.parent)return.5*(e.parent.y-e.y)}),c.select("circle.nodeCircle").attr("r",function(e){return Il.showNodeVisualizations&&!Il.showNodeEvents&&Ba(e)===Il.backgroundColorDefault&&Aa(e)===Il.backgroundColorDefault?0:Ea(e)}).style("stroke",function(e){return Ba(e)}).style("stroke-width",Il.branchWidthDefault).style("fill",function(e){return Il.showNodeVisualizations||Il.showNodeEvents?Aa(e):Il.backgroundColorDefault});var u=Il.phylogram?-1:-10,f=Ql/(3*a),h=c.transition().duration(n).attr("transform",function(e){return"translate("+e.y+","+e.x+")"});h.select("text").style("fill-opacity",1),h.select("text.extlabel").text(function(e){if(!Il.dynahide||!e.hide)return Ma(e)}),h.select("text.bllabel").text(Il.showBranchLengthValues?Xa:null),h.select("text.conflabel").text(Il.showConfidenceValues?Ua:null),h.select("text.brancheventlabel").text(Il.showBranchEvents?Ha:null),h.select("path").style("stroke",Il.showNodeVisualizations?Va:null).style("stroke-width",Il.branchWidthDefault).style("fill",Il.showNodeVisualizations?La:null).style("opacity",Il.nodeVisualizationsOpacity).attr("d",Il.showNodeVisualizations?Ta:null),c.each(function(e){if(e._children){var t=f,o=forester.getAllExternalNodes(e);o.length<5&&(t*=.5);var l=forester.calcAverageTreeHeight(e,o),a=Il.phylogram?Hl(l):0;e.avg=a;var r=e.width?e.width/2:Il.branchWidthDefault/2,i=ka(e);d3.select(this).select("path").transition().duration(n).attr("d",function(){return"M"+u+","+-r+"L"+a+","+-t+"L"+a+","+t+"L"+u+","+r+"L"+u+","+-r}).style("stroke",i).style("fill",i),d3.select(this).select(".collapsedText").attr("font-size",function(e){return Il.externalNodeFontSize+"px"}),d3.select(this).select(".collapsedText").transition().duration(n).style("fill-opacity",1).text(qa(e,o)).style("fill",function(e){return _a(e,i)}).attr("dy",function(e){return.3*Il.externalNodeFontSize+"px"}).attr("x",function(e){if(Il.phylogram&&Il.alignPhylogram){for(var t=e;t.children&&t.children.length>0;)t=t.children[0];return-Hl(t.distToRoot)+pa+s}return a+s})}e.children&&(Il.showNodeVisualizations||null!==Ta(e)||d3.select(this).select("path").transition().duration(n).attr("d",function(){return"M0,0"}),d3.select(this).select(".collapsedText").transition().duration(n).attr("x",0).style("fill-opacity",1e-6).each("end",function(){d3.select(this).text("")}))});var p=c.exit().transition().duration(n).attr("transform",function(){return"translate("+e.y+","+e.x+")"}).remove();p.select("circle").attr("r",0),p.select("text").style("fill-opacity",0);var g=Tl.selectAll("path.link").attr("d",Wa).attr("stroke-width",Sa).data(i,function(e){return e.target.id});if(g.enter().insert("path","g").attr("class","link").attr("fill","none").attr("stroke-width",Sa).attr("stroke",Na).attr("d",function(){var t={x:e.x0,y:e.y0};return Wa({source:t,target:t})}),g.transition().duration(n).attr("d",Wa),g.exit().attr("d",function(){var t={x:e.x,y:e.y};return Wa({source:t,target:t})}).remove(),Il.phylogram&&Il.alignPhylogram&&Il.showExternalLabels&&(Il.showNodeName||Il.showTaxonomy||Il.showSequence)){var m=Tl.append("g").selectAll("path").data(i.filter(function(e){return!(e.target.children||Il.dynahide&&e.target.hide)}));m.enter().insert("path","g").attr("class","link").attr("fill","none").attr("stroke-width",1).attr("stroke",Il.branchColorDefault).style("stroke-opacity",.25).attr("d",function(e){return Ya(e.target)})}r.forEach(function(e){e.x0=e.x,e.y0=e.y})}function N(e){return e.duplications>0&&(!e.speciations||e.speciations<=0)?Ut:e.speciations>0&&(!e.duplications||e.duplications<=0)?Ht:e.speciations>0&&e.duplications>0?Wt:null}function A(e,t){t&&(va[e]=t.mappingFn?t.mappingFn:null)}function B(e,t){t&&(Fa[e]=t.mappingFn?t.mappingFn:null)}function k(e,t){t&&(ba[e]=t.mappingFn?t.mappingFn:null)}function _(e){va[e]=null}function T(e){Fa[e]=null}function L(e){ba[e]=null}function R(e){var t=0,n=0,o=0,l=0;if(Wl&&Yl&&forester.preOrderTraversalAll(e,function(e){forester.isHasNodeData(e)&&(++l,Wl.has(e)&&Yl.has(e)?++o:Wl.has(e)?++t:Yl.has(e)&&++n)}),Gl=o+t+n,Kl=l,l>0&&Gl>0){if(o>0||t>0&&n>0)return o===l?Il.found0and1ColorDefault:d3.scale.linear().domain([0,l]).range([Il.branchColorDefault,Il.found0and1ColorDefault])(Gl);if(t>0)return t===l?Il.found0ColorDefault:d3.scale.linear().domain([0,l]).range([Il.branchColorDefault,Il.found0ColorDefault])(t);if(n>0)return n===l?Il.found1ColorDefault:d3.scale.linear().domain([0,l]).range([Il.branchColorDefault,Il.found1ColorDefault])(n)}return null}function V(e){if(Il.searchNegateResult){if(forester.isHasNodeData(e)){if(Wl&&!jl&&Yl&&!Jl&&!Wl.has(e)&&!Yl.has(e))return Il.found0and1ColorDefault;if(Wl&&!jl&&!Wl.has(e))return Il.found0ColorDefault;if(Yl&&!Jl&&!Yl.has(e))return Il.found1ColorDefault}}else{if(Wl&&Yl&&Wl.has(e)&&Yl.has(e))return Il.found0and1ColorDefault;if(Wl&&Wl.has(e))return Il.found0ColorDefault;if(Yl&&Yl.has(e))return Il.found1ColorDefault}return null}function P(e){Il=e?e:{},sa.branchLengths?(void 0===Il.phylogram&&(Il.phylogram=!0),void 0===Il.alignPhylogram&&(Il.alignPhylogram=!1)):(Il.phylogram=!1,Il.alignPhylogram=!1),Il.phylogram===!1&&(Il.alignPhylogram=!1),void 0===Il.dynahide&&(Il.dynahide=!1),void 0===Il.showBranchLengthValues&&(Il.showBranchLengthValues=!1),void 0===Il.showConfidenceValues&&(Il.showConfidenceValues=!1),void 0===Il.showNodeName&&(Il.showNodeName=!1),void 0===Il.showTaxonomy&&(Il.showTaxonomy=!1),void 0===Il.showTaxonomyCode&&(Il.showTaxonomyCode=!1),void 0===Il.showTaxonomyScientificName&&(Il.showTaxonomyScientificName=!1),void 0===Il.showTaxonomyCommonName&&(Il.showTaxonomyCommonName=!1),void 0===Il.showTaxonomyRank&&(Il.showTaxonomyRank=!1),void 0===Il.showTaxonomySynonyms&&(Il.showTaxonomySynonyms=!1),void 0===Il.showSequence&&(Il.showSequence=!1),void 0===Il.showSequenceSymbol&&(Il.showSequenceSymbol=!1),void 0===Il.showSequenceName&&(Il.showSequenceName=!1),void 0===Il.showSequenceGeneSymbol&&(Il.showSequenceGeneSymbol=!1),void 0===Il.showSequenceAccession&&(Il.showSequenceAccession=!1),void 0===Il.showDistributions&&(Il.showDistributions=!1),void 0===Il.showInternalNodes&&(Il.showInternalNodes=!1),void 0===Il.showExternalNodes&&(Il.showExternalNodes=!1),void 0===Il.showInternalLabels&&(Il.showInternalLabels=!1),void 0===Il.showExternalLabels&&(Il.showExternalLabels=!1),Il.branchWidthDefault||(Il.branchWidthDefault=2),Il.branchColorDefault||(Il.branchColorDefault="#aaaaaa"),Il.labelColorDefault||(Il.labelColorDefault="#202020"),Il.backgroundColorDefault||(Il.backgroundColorDefault="#f0f0f0"),Il.found0ColorDefault||(Il.found0ColorDefault="#00ff00"),Il.found1ColorDefault||(Il.found1ColorDefault="#ff0000"),Il.found0and1ColorDefault||(Il.found0and1ColorDefault="#00ffff"),Il.defaultFont||(Il.defaultFont="Times"),Il.nodeSizeDefault||(Il.nodeSizeDefault=3),Il.externalNodeFontSize||(Il.externalNodeFontSize=10),Il.internalNodeFontSize||(Il.internalNodeFontSize=9),Il.branchDataFontSize||(Il.branchDataFontSize=7),Il.collapasedLabelLength||(Il.collapasedLabelLength=7),Il.nodeLabelGap||(Il.nodeLabelGap=10),Il.minBranchLengthValueToShow||(Il.minBranchLengthValueToShow=null),void 0===Il.minConfidenceValueToShow&&(Il.minConfidenceValueToShow=null),void 0===Il.searchIsCaseSensitive&&(Il.searchIsCaseSensitive=!1),void 0===Il.searchIsPartial&&(Il.searchIsPartial=!0),Il.searchNegateResult=!1,void 0===Il.searchUsesRegex&&(Il.searchUsesRegex=!1),void 0===Il.alignPhylogram&&(Il.alignPhylogram=!1),void 0===Il.showNodeEvents&&(Il.showNodeEvents=!1),void 0===Il.showBranchEvents&&(Il.showBranchEvents=!1),void 0===Il.showNodeVisualizations&&(Il.showNodeVisualizations=!1),void 0===Il.showBranchVisualizations&&(Il.showBranchVisualizations=!1),void 0===Il.nodeVisualizationsOpacity&&(Il.nodeVisualizationsOpacity=1),Il.nameForNhDownload||(Il.nameForNhDownload=So),Il.nameForPhyloXmlDownload||(Il.nameForPhyloXmlDownload=No),Il.nameForPngDownload||(Il.nameForPngDownload=Ao),Il.nameForSvgDownload||(Il.nameForSvgDownload=Bo),Il.visualizationsLegendXpos||(Il.visualizationsLegendXpos=Wo),Il.visualizationsLegendYpos||(Il.visualizationsLegendYpos=Yo),Il.visualizationsLegendXposOrig=Il.visualizationsLegendXpos,Il.visualizationsLegendYposOrig=Il.visualizationsLegendYpos,Il.visualizationsLegendOrientation||(Il.visualizationsLegendOrientation=Go),void 0===!Il.showVisualizationsLegend&&(Il.showVisualizationsLegend=!0)}function I(e){Ol=e?e:{},Ol.rootOffset||(Ol.rootOffset=_t),Ol.displayWidth||(Ol.displayWidth=Tt),Ol.displayHeight||(Ol.displayHeight=Lt),Ol.reCenterAfterCollapse||(Ol.reCenterAfterCollapse=Yt),Ol.controlsFontSize||(Ol.controlsFontSize=Ot),Ol.controlsFontColor||(Ol.controlsFontColor=Mt),Ol.controlsFont||(Ol.controlsFont=qt),Ol.controlsBackgroundColor||(Ol.controlsBackgroundColor=Xt),Ol.controls0Left||(Ol.controls0Left=Rt),Ol.controls0Top||(Ol.controls0Top=Vt),Ol.controls1Top||(Ol.controls1Top=It),Ol.controls1Left||(Ol.controls1Left=Ol.displayWidth-Pt),void 0===Ol.enableDownloads&&(Ol.enableDownloads=!1),void 0===Ol.enableBranchVisualizations&&(Ol.enableBranchVisualizations=!1),void 0===Ol.enableNodeVisualizations&&(Ol.enableNodeVisualizations=!1),void 0===Ol.enableCollapseByBranchLenghts&&(Ol.enableCollapseByBranchLenghts=!1),void 0===Ol.enableCollapseByTaxonomyRank&&(Ol.enableCollapseByTaxonomyRank=!1),void 0===Ol.enableCollapseByFeature&&(Ol.enableCollapseByFeature=!1),void 0===Ol.nhExportWriteConfidences&&(Ol.nhExportWriteConfidences=!1),O()}function O(){Ql=Ol.displayHeight,Zl=Ol.displayWidth}function M(){1===d3.event.which&&(d3.event.altKey||d3.event.shiftKey)&&xa&&(Ol.enableNodeVisualizations||Ol.enableBranchVisualizations)&&(va[Vo]||Il.showNodeVisualizations&&(va[Po]||va[Io]||Fa[Oo]||ba[Mo]))&&Le(d3.event)}function q(){ql=Il.nodeLabelGap,forester.preOrderTraversal(Pl,function(e){if(e._children)ql=Math.max(2*Il.collapasedLabelLength+8,ql);else if(!e.children){var t=Ma(e);t&&(ql=Math.max(t.length,ql))}})}function X(){Tl.selectAll(".tooltipElem").remove()}function U(e){function t(t){function n(e){var t=e.name?"Node Data: "+e.name:"Node Data",n="";e.name&&(n+="Name: "+e.name+"<br>"),e.branch_length&&(n+="Distance to Parent: "+e.branch_length+"<br>");var o=0;if(e.confidences)for(o=0;o<e.confidences.length;++o){var l=e.confidences[o];n+=l.type?"Confidence ["+l.type+"]: "+l.value+"<br>":"Confidence: "+l.value+"<br>",l.stddev&&(n+="- stdev: "+l.stddev+"<br>")}if(e.taxonomies)for(o=0;o<e.taxonomies.length;++o){n+="Taxonomy<br>";var a=e.taxonomies[o];a.id&&(n+=a.id.provider?"- Id ["+a.id.provider+"]: "+a.id.value+"<br>":"- Id: "+a.id.value+"<br>"),a.code&&(n+="- Code: "+a.code+"<br>"),a.scientific_name&&(n+="- Scientific name: "+a.scientific_name+"<br>"),a.common_name&&(n+="- Common name: "+a.common_name+"<br>"),a.rank&&(n+="- Rank: "+a.rank+"<br>")}if(e.sequences)for(o=0;o<e.sequences.length;++o){n+="Sequence<br>";var r=e.sequences[o];r.accession&&(n+=r.accession.source?"- Accession ["+r.accession.source+"]: "+r.accession.value+"<br>":"- Accession: "+r.accession.value+"<br>",r.accession.comment&&(n+="-- comment: "+r.accession.comment+"<br>")),r.symbol&&(n+="- Symbol: "+r.symbol+"<br>"),r.name&&(n+="- Name: "+r.name+"<br>"),r.gene_name&&(n+="- Gene name: "+r.gene_name+"<br>"),r.location&&(n+="- Location: "+r.location+"<br>"),r.type&&(n+="- Type: "+r.type+"<br>")}if(e.distributions){var i=e.distributions;for(o=0;o<i.length;++o)n+="Distribution: ",i[o].desc&&(n+=i[o].desc+"<br>")}if(e.date){n+="Date: ";var s=e.date;s.desc&&(n+=s.desc+"<br>")}if(e.events){n+="Events<br>";var c=e.events;c.type&&c.type.length>0&&(n+="- Type: "+c.type+"<br>"),c.duplications&&c.duplications>0&&(n+="- Duplications: "+c.duplications+"<br>"),
c.speciations&&c.speciations>0&&(n+="- Speciations: "+c.speciations+"<br>"),c.losses&&c.losses>0&&(n+="- Losses: "+c.losses+"<br>")}if(e.properties&&e.properties.length>0){var d=e.properties.length;for(o=0;o<d;++o){var u=e.properties[o];u.ref&&u.value&&(n+=u.unit?u.ref+": "+u.value+u.unit+"<br>":u.ref+": "+u.value+"<br>")}}(e.children||e._children)&&(n+="Number of External Nodes: "+forester.calcSumOfAllExternalDescendants(e)+"<br>"),n+="Depth: "+forester.calcDepth(e)+"<br>";var f=document.getElementById(ao);f&&f.outerHTML&&(f.outerHTML=""),$("<div id='"+ao+"'>"+n+"</div>").dialog();var h=$("#"+ao);$(".ui-dialog").css({"text-align":"left",color:Ol.controlsFontColor,"font-size":Ol.controlsFontSize,"font-family":Ol.controlsFont,"font-style":"normal","font-weight":"normal","text-decoration":"none"}),$(".ui-dialog-titlebar").css({"text-align":"left",color:Ol.controlsFontColor,"font-size":Ol.controlsFontSize,"font-family":Ol.controlsFont,"font-style":"normal","font-weight":"bold","text-decoration":"none"}),h.dialog("option","modal",!0),h.dialog("option","title",t),S()}function o(e){if(e.parent&&(e.children||e._children))if(Vl.length>0&&e===_l.children[0])_l=Vl.pop(),vt(),Ft(),bt(),K();else if(e.parent.parent){Vl.push(_l);var t={};t.children=[e],t.x=0,t.x0=0,t.y=0,t.y0=0,_l=t,e._children&&(e.children=e._children,e._children=null),vt(),Ft(),bt(),K()}}function l(e){var t=e.children,n=t.length;if(n>1){for(var o=t[0],l=0;l<n-1;++l)t[l]=t[l+1];t[n-1]=o}}function a(e){e.children?(e._children=e.children,e.children=null):tt(e)}wa===!0&&(C(),S());var r=120,i=150;X(),d3.select(this).append("rect").attr("class","tooltipElem").attr("x",0).attr("y",0).attr("width",r).attr("height",i).attr("rx",10).attr("ry",10).style("fill-opacity",.9).style("fill",on);var s=10,c=20,d=0,u=20;d3.select(this).append("text").attr("class","tooltipElem tooltipElemText").attr("y",c+d).attr("x",+s).style("text-align","left").style("fill",nn).style("font-size",Ol.controlsFontSize).style("font-family",Ol.controlsFont).style("font-style","normal").style("font-weight","bold").style("text-decoration","none").text(function(e){if(e.parent)return d+=u,"Display Node Data"}).on("click",function(e){n(e)}),d3.select(this).append("text").attr("class","tooltipElem tooltipElemText").attr("y",c+d).attr("x",+s).style("text-align","left").style("fill",nn).style("font-size",Ol.controlsFontSize).style("font-family",Ol.controlsFont).style("font-style","normal").style("font-weight","bold").style("text-decoration","none").text(function(e){if(e.parent&&e.parent.parent){if(e._children)return d+=u,"Uncollapse";if(e.children)return d+=u,"Collapse"}}).on("click",function(e){a(e),vt(),Ft(),bt(),ut(),S(e)}),d3.select(this).append("text").attr("class","tooltipElem tooltipElemText").attr("y",c+d).attr("x",+s).style("text-align","left").style("fill",nn).style("font-size",Ol.controlsFontSize).style("font-family",Ol.controlsFont).style("font-style","normal").style("font-weight","bold").style("text-decoration","none").text(function(e){var t=0;if(forester.preOrderTraversalAll(e,function(e){e._children&&++t}),t>1||1==t&&!e._children)return d+=u,"Uncollapse All"}).on("click",function(e){tt(e),vt(),Ft(),bt(),ut(),S()}),d3.select(this).append("text").attr("class","tooltipElem tooltipElemText").attr("y",c+d).attr("x",+s).style("text-align","left").style("fill",nn).style("font-size",Ol.controlsFontSize).style("font-family",Ol.controlsFont).style("font-style","normal").style("font-weight","bold").style("text-decoration","none").text(function(e){if(e.parent&&(e.children||e._children)){if(Vl.length>0&&e===_l.children[0])return d+=u,"Return to Super-tree";if(e.parent.parent)return d+=u,"Go to Sub-tree"}}).on("click",function(e){o(e)}),d3.select(this).append("text").attr("class","tooltipElem tooltipElemText").attr("y",c+d).attr("x",+s).style("text-align","left").style("fill",nn).style("font-size",Ol.controlsFontSize).style("font-family",Ol.controlsFont).style("font-style","normal").style("font-weight","bold").style("text-decoration","none").text(function(e){if(e.parent&&e.children)return d+=u,"Swap Descendants"}).on("click",function(e){l(e),S()}),d3.select(this).append("text").attr("class","tooltipElem tooltipElemText").attr("y",c+d).attr("x",+s).style("text-align","left").style("fill",nn).style("font-size",Ol.controlsFontSize).style("font-family",Ol.controlsFont).style("font-style","normal").style("font-weight","bold").style("text-decoration","none").text(function(e){if(e.parent&&e.children)return d+=u,"Order Subtree"}).on("click",function(e){Rl.visData||(Rl.visData={}),void 0===Rl.visData.order&&(Rl.visData.order=!0),Ze(e,Rl.visData.order),Rl.visData.order=!Rl.visData.order,S(null,0)}),d3.select(this).append("text").attr("class","tooltipElem tooltipElemText").attr("y",c+d).attr("x",+s).style("text-align","left").style("align","left").style("vertical-align","left").style("fill",nn).style("font-size",Ol.controlsFontSize).style("font-family",Ol.controlsFont).style("font-style","normal").style("font-weight","bold").style("text-decoration","none").text(function(e){if(e.parent&&e.parent.parent&&Vl.length<1)return d+=u,"Reroot"}).on("click",function(t){forester.reRoot(e,t,-1),vt(),Ft(),bt(),ut(),tt(_l),K()}),d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},d3.select(this).moveToFront(),d3.select(this).selectAll(".tooltipElemText").each(function(e){d3.select(this).on("mouseover",function(e){d3.select(this).transition().duration(50).style("fill","#000000")}),d3.select(this).on("mouseout",function(e){d3.select(this).transition().duration(50).style("fill","#ffffff")})})}return t}function H(e){Zl*=e?e:Zt,S(null,0)}function W(e){Ql*=e?e:Zt,S(null,0)}function Y(e){var t;t=e?Zl*e:Zl*Qt,t-l()>=1&&(Zl=t,S(null,0))}function G(e){Ql*=e?e:Qt;var t=.25*Ol.displayHeight;Ql<t&&(Ql=t),S(null,0)}function K(){_l&&(q(),O(),I(Ol),C(),Ul.scale(1),S(_l,0),o(_l,Ol.rootOffset))}function j(){_l&&Vl.length>0&&(_l=Vl.pop(),vt(),Ft(),bt(),K())}function J(){_l&&(Rl.visData||(Rl.visData={}),void 0===Rl.visData.order&&(Rl.visData.order=!0),Ze(_l,Rl.visData.order),Rl.visData.order=!Rl.visData.order,S(null,0))}function Z(){_l&&forester.isHasCollapsedNodes(_l)&&(tt(_l),vt(),Ft(),bt(),ut(),K())}function Q(){(Ol.enableNodeVisualizations||Ol.enableBranchVisualizations)&&Ie(),K();var e=$("#"+pn);e&&e.css({left:Ol.controls0Left,top:Ol.controls0Top+ya});var t=$("#"+gn);t&&t.css({left:Ol.controls1Left,top:Ol.controls1Top+ya})}function ee(){Wl.clear(),jl=!0;var e=$("#"+Yn).val();if(e&&e.length>0){var t=e.trim();t.length>0&&(jl=!1,Wl=le(t))}S(0,null,!0)}function te(){Yl.clear(),Jl=!0;var e=$("#"+Gn).val();if(e&&e.length>0){var t=e.trim();t.length>0&&(Jl=!1,Yl=le(t))}S(0,null,!0)}function ne(){Wl.clear(),jl=!0,$("#"+Yn).val(""),S(0,null,!0)}function oe(){Yl.clear(),Jl=!0,$("#"+Gn).val(""),S(0,null,!0)}function le(e){return forester.searchData(e,Pl,Il.searchIsCaseSensitive,Il.searchIsPartial,Il.searchUsesRegex)}function ae(){Il.phylogram=!0,Il.alignPhylogram=!1,et(),S(null,0)}function re(){Il.phylogram=!0,Il.alignPhylogram=!0,et(),S(null,0)}function ie(){Il.phylogram=!1,Il.alignPhylogram=!1,et(),S(null,0)}function se(){Il.showNodeName=Xe(xn),Il.showNodeName&&(Il.showExternalLabels=!0,qe(An,!0)),S()}function ce(){Il.showTaxonomy=Xe(wn),Il.showTaxonomy&&(Il.showExternalLabels=!0,qe(An,!0)),S()}function de(){Il.showSequence=Xe(Cn),Il.showSequence&&(Il.showExternalLabels=!0,qe(An,!0)),S()}function ue(){Il.showConfidenceValues=Xe(zn),S()}function fe(){Il.showBranchLengthValues=Xe(Dn),S()}function he(){Il.showNodeEvents=Xe(En),S()}function pe(){Il.showBranchEvents=Xe(Sn),S()}function ge(){Il.showInternalLabels=Xe(Nn),S()}function me(){Il.showExternalLabels=Xe(An),S()}function ye(){Il.showInternalNodes=Xe(Bn),S()}function ve(){Il.showExternalNodes=Xe(kn),S()}function Fe(){Il.showNodeVisualizations=Xe($n),f(),S(null,0),S(null,0)}function be(){Il.showBranchVisualizations=Xe(_n),f(),S(null,0),S(null,0)}function xe(){var e=$("#"+xo);if(e){var t=e.val();wt(t)}}function we(e,t){Il.branchWidthDefault=Ue(t),S(null,0,!0)}function Ce(e,t){Il.nodeSizeDefault=Ue(t),Il.showInternalNodes||Il.showExternalNodes||Il.showNodeVisualizations||Il.showNodeEvents||(Il.showInternalNodes=!0,Il.showExternalNodes=!0,qe(Bn,!0),qe(kn,!0)),S(null,0,!0)}function ze(e,t){Il.internalNodeFontSize=Ue(t),S(null,0,!0)}function De(e,t){Il.externalNodeFontSize=Ue(t),S(null,0,!0)}function Ee(e,t){Il.branchDataFontSize=Ue(t),S(null,0,!0)}function Se(){Il.searchIsCaseSensitive=Xe(mo),ee(),te()}function Ne(){Il.searchIsPartial=!Xe(yo),Il.searchIsPartial===!1&&(Il.searchUsesRegex=!1,qe(vo,Il.searchUsesRegex)),ee(),te()}function Ae(){Il.searchUsesRegex=Xe(vo),Il.searchUsesRegex===!0&&(Il.searchIsPartial=!0,qe(yo,!Il.searchIsPartial)),ee(),te()}function Be(){Il.searchNegateResult=Xe(Fo),ee(),te()}function ke(e){e||(e=10),Il.visualizationsLegendYpos>0&&(Il.visualizationsLegendYpos-=e,S(null,0))}function $e(e){e||(e=10),Il.visualizationsLegendYpos<Ol.displayHeight&&(Il.visualizationsLegendYpos+=e,S(null,0))}function _e(e){e||(e=10),Il.visualizationsLegendXpos<Ol.displayWidth&&(Il.visualizationsLegendXpos+=e,S(null,0))}function Te(e){e||(e=10),Il.visualizationsLegendXpos>0&&(Il.visualizationsLegendXpos-=e,S(null,0))}function Le(e){var t=e.layerX,n=e.layerY;t>0&&t<Zl&&(Il.visualizationsLegendXpos=t),n>0&&n<Ql&&(Il.visualizationsLegendYpos=n),S(null,0)}function Re(){Il.visualizationsLegendOrientation===Ho?Il.visualizationsLegendOrientation=Uo:Il.visualizationsLegendOrientation=Ho,C(),S(null,0)}function Ve(){xa=!xa,xa||C(),S(null,0)}function Pe(){C(),Ie(),S(null,0)}function Ie(){Il.visualizationsLegendXpos=Il.visualizationsLegendXposOrig,Il.visualizationsLegendYpos=Il.visualizationsLegendYposOrig}function Oe(e,t,n,o,l){w(e,t,n,o,l),S()}function Me(e,t){var n=$("#"+e);n&&(n[0].checked=t,n.button("refresh"))}function qe(e,t){var n=$("#"+e);n&&n[0]&&(n[0].checked=t,n.button("refresh"))}function Xe(e){return $("#"+e).is(":checked")}function Ue(e){return e.value}function He(e,t){var n=$("#"+e);n&&n.slider("value",t)}function We(){var e=2*un,t=cn-e,n=!1;Il.externalNodeFontSize<=t&&(Il.externalNodeFontSize+=e,n=!0),Il.internalNodeFontSize<=t&&(Il.internalNodeFontSize+=e,n=!0),Il.branchDataFontSize<=t&&(Il.branchDataFontSize+=e,n=!0),n&&(He(On,Il.externalNodeFontSize),He(In,Il.internalNodeFontSize),He(Mn,Il.branchDataFontSize),S(0,null,!0))}function Ye(){var e=2*un,t=dn+e,n=!1;Il.externalNodeFontSize>=t&&(Il.externalNodeFontSize-=e,n=!0),Il.internalNodeFontSize>=t&&(Il.internalNodeFontSize-=e,n=!0),Il.branchDataFontSize>=t&&(Il.branchDataFontSize-=e,n=!0),n&&(He(On,Il.externalNodeFontSize),He(In,Il.internalNodeFontSize),He(Mn,Il.branchDataFontSize),S(0,null,!0))}function Ge(){function e(){var e="";return e=e.concat("<div class="+kt+">"),e=e.concat('<a href="'+At+'" target="_blank">'+Bt+" "+Nt+"</a>"),e=e.concat("</div>")}function t(){var e="radio-1",t="";return t=t.concat("<fieldset>"),t=t.concat('<div class="'+Fn+'">'),t=t.concat(g("P",mn,e,"phylogram display (uses branch length values)  (use Alt+P to cycle between display types)")),t=t.concat(g("A",yn,e,"phylogram display (uses branch length values) with aligned labels  (use Alt+P to cycle between display types)")),t=t.concat(g("C",vn,e," cladogram display (ignores branch length values)  (use Alt+P to cycle between display types)")),t=t.concat("</div>"),t=t.concat("</fieldset>")}function n(){var e="";return e=e.concat("<fieldset><legend>Display Data</legend>"),e=e.concat('<div class="'+bn+'">'),sa.nodeNames&&(e=e.concat(p("Node Name",xn,"to show/hide node names (node names usually are the untyped labels found in New Hampshire/Newick formatted trees)"))),sa.taxonomies&&(e=e.concat(p("Taxonomy",wn,"to show/hide node taxonomic information"))),sa.sequences&&(e=e.concat(p("Sequence",Cn,"to show/hide node sequence information"))),sa.confidences&&(e=e.concat(p("Confidence",zn,"to show/hide confidence values"))),sa.branchLengths&&(e=e.concat(p("Branch Length",Dn,"to show/hide branch length values"))),sa.nodeEvents&&(e=e.concat(p("Node Events",En,"to show speciations and duplications as colored nodes (e.g. speciations green, duplications red)"))),sa.branchEvents&&(e=e.concat(p("Branch Events",Sn,"to show/hide branch events (e.g. mutations)"))),e=e.concat(p("External Labels",An,"to show/hide external node labels")),sa.internalNodeData&&(e=e.concat(p("Internal Labels",Nn,"to show/hide internal node labels"))),e=e.concat(p("External Nodes",kn,"to show external nodes as shapes (usually circles)")),e=e.concat(p("Internal Nodes",Bn,"to show internal nodes as shapes (usually circles)")),Ol.enableNodeVisualizations&&(e=e.concat(p("Node Vis",$n,"to show/hide node visualizations (colors, shapes, sizes), set with the Visualizations sub-menu"))),Ol.enableBranchVisualizations&&(e=e.concat(p("Branch Vis",_n,"to show/hide branch visualizations, set with the Visualizations sub-menu"))),e=e.concat("</div>"),e=e.concat("</fieldset>")}function o(){var e="";return e=e.concat("<fieldset>"),e=e.concat("<legend>Zoom</legend>"),e=e.concat(h("Y+",Tn,"zoom in vertically (Alt+Up or Shift+mousewheel)")),e=e.concat("<br>"),e=e.concat(h("X-",Vn,"zoom out horizontally (Alt+Left or Shift+Alt+mousewheel)")),e=e.concat(h("F",Pn,"fit and center tree display (Alt+C, Home, or Esc to re-position controls as well)")),e=e.concat(h("X+",Rn,"zoom in horizontally (Alt+Right or Shift+Alt+mousewheel)")),e=e.concat("<br>"),e=e.concat(h("Y-",Ln,"zoom out vertically (Alt+Down or Shift+mousewheel)")),e=e.concat("</fieldset>")}function l(){var e="";return e=e.concat("<fieldset>"),e=e.concat("<legend>Tools</legend>"),e=e.concat("<div>"),e=e.concat(h("O",Un,"order all (Alt+O)")),e=e.concat(h("R",Hn,"return to the super-tree (if in sub-tree) (Alt+R)")),e=e.concat(h("U",Wn,"uncollapse all (Alt+U)")),e=e.concat("</div>"),e=e.concat("</fieldset>")}function a(){var e="";return e=e.concat('<form action="#">'),e=e.concat("<fieldset>"),e=e.concat('<input type="button" value="Download" name="'+bo+'" title="download/export tree in a selected format" id="'+bo+'">'),e=e.concat("<br>"),e=e.concat('<select name="'+xo+'" id="'+xo+'">'),e=e.concat('<option value="'+wo+'">'+wo+"</option>"),e=e.concat('<option value="'+Co+'">'+Co+"</option>"),e=e.concat('<option value="'+zo+'">'+zo+"</option>"),e=e.concat('<option value="'+Do+'">'+Do+"</option>"),e=e.concat("</select>"),e=e.concat("</fieldset>"),e=e.concat("</form>")}function r(){var e="";return e=e.concat("<fieldset>"),e=e.concat(y("External label size:",On)),sa.internalNodeData&&(e=e.concat(y("Internal label size:",In))),(sa.branchLengths||sa.confidences||sa.branchEvents)&&(e=e.concat(y("Branch label size:",Mn))),e=e.concat(y("Node size:",Xn)),e=e.concat(y("Branch width:",qn)),e=e.concat("</fieldset>")}function i(){var e="";if(e=e.concat("<fieldset>"),e=e.concat("<legend>Collapse Depth</legend>"),e=e.concat(h("-",Qn,"to decrease the depth threshold (wraps around) (Alt+A)")),e=e.concat(v(oo,"the current depth threshold")),e=e.concat(h("+",eo,"to increase the depth threshold (wraps around) (Alt+S)")),e=e.concat("</fieldset>"),Ol.enableCollapseByBranchLenghts&&sa.branchLengths&&(e=e.concat("<fieldset>"),e=e.concat("<legend>Collapse Length</legend>"),e=e.concat(h("-",to,"to decrease the maximal subtree branch length threshold (wraps around)")),e=e.concat(v(lo,"the current maximal subtree branch length threshold")),e=e.concat(h("+",no,"to increase the maximal subtree branch length threshold (wraps around)")),e=e.concat("</fieldset>")),Ol.enableCollapseByTaxonomyRank,Ol.enableCollapseByFeature){e=e.concat("<fieldset>"),e=e.concat("<legend>Collapse Feature</legend>"),e=e.concat('<select name="'+ro+'" id="'+ro+'">'),e=e.concat('<option value="'+so+'">'+so+"</option>"),sa.taxonomies&&(e=e.concat('<option value="'+io+'">'+io+"</option>"));var t=forester.collectPropertyRefs(Pl,"node",!1);t&&t.forEach(function(t){e=e.concat('<option value="'+t+'">'+t+"</option>")}),e=e.concat("</select>"),e=e.concat("</fieldset>")}return e}function s(){var e="enter text to search for (use ',' for logical OR and '+' for logical AND, use expressions in form of XX:term for typed search -- e.g. NN:node name, TC:taxonomy code, TS:taxonomy scientific name, SN:sequence name, GN:gene name, SS:sequence symbol, MS:molecular sequence, ...)",t="";return t=t.concat("<fieldset>"),t=t.concat("<legend>Search</legend>"),t=t.concat(v(Yn,e)),t=t.concat(h("R",Kn,Jn)),t=t.concat("<br>"),t=t.concat(v(Gn,e)),t=t.concat(h("R",jn,Zn)),t=t.concat("<br>"),t=t.concat("<br>"),t=t.concat(c()),t=t.concat("</fieldset>")}function c(){var e="";return e=e.concat('<div class="'+go+'">'),e=e.concat(p("Cas",mo,"to search in a case-sensitive manner")),e=e.concat(p("Wrd",yo," to match complete terms (separated by spaces or underscores) only (does not apply to regular expression search)")),e=e.concat("</div>"),e=e.concat("<br>"),e=e.concat('<div class="'+go+'">'),e=e.concat(p("Neg",Fo,"to invert (negate) the search results")),e=e.concat(p("Reg",vo,"to search with regular expressions")),e=e.concat("</div>")}function d(){var e="";return e=e.concat('<form action="#">'),e=e.concat("<fieldset>"),e=e.concat("<legend>Visualizations</legend>"),e=e.concat(m("Label Color:","<br>",po,"colorize the node label according to a property")),e=e.concat("<br>"),e=e.concat(m("Node Fill Color:","<br>",uo,"colorize the node fill according to a property")),e=e.concat("<br>"),e=e.concat(m("Node Border Color:","<br>",fo,"colorize the node border according to a property")),e=e.concat("<br>"),e=e.concat(m("Node Shape:","<br>",co,"change the node shape according to a property")),e=e.concat("<br>"),e=e.concat(m("Node Size:","<br>",ho,"change the node size according to a property")),e=e.concat("</fieldset>"),e=e.concat("</form>")}function u(){var e=" (alternatively, place legend with mouse using shift+left-mouse-button click, or alt+left-mouse-button click)",t="";return t=t.concat("<fieldset>"),t=t.concat("<legend>Vis Legend</legend>"),t=t.concat(h("Show",Ko,"to show/hide legend(s)")),t=t.concat(h("Dir",jo,"to toggle between vertical and horizontal alignment of (multiple) legends")),t=t.concat("<br>"),t=t.concat(h("^",Jo,"move legend(s) up"+e)),t=t.concat("<br>"),t=t.concat(h("<",Zo,"move legend(s) left"+e)),t=t.concat(h("R",Qo,"return legend(s) to original position"+e)),t=t.concat(h(">",el,"move legend(s) right"+e)),t=t.concat("<br>"),t=t.concat(h("v",tl,"move legend(s) down"+e)),t=t.concat("</fieldset>")}function h(e,t,n){return'<input type="button" value="'+e+'" name="'+t+'" id="'+t+'" title="'+n+'">'}function p(e,t,n){return'<label for="'+t+'" title="'+n+'">'+e+'</label><input type="checkbox" name="'+t+'" id="'+t+'">'}function g(e,t,n,o){return'<label for="'+t+'" title="'+o+'">'+e+'</label><input type="radio" name="'+n+'" id="'+t+'">'}function m(e,t,n,o){return'<label for="'+n+'" title="'+o+'">'+e+"</label>"+t+'<select name="'+n+'" id="'+n+'"></select>'}function y(e,t){return e+'<div id="'+t+'"></div>'}function v(e,t){return'<input title="'+t+'" type="text" name="'+e+'" id="'+e+'">'}var F=d3.select(ma);if(F&&F[0]){var b=F[0][0];b&&(ya=b.offsetTop,b.style.textAlign="left")}var x=$("#"+pn);if(x){x.css({position:"absolute",left:Ol.controls0Left,top:Ol.controls0Top+ya,"text-align":"left",padding:"0.1em",opacity:"0.85","background-color":Ol.controlsBackgroundColor,color:Ol.controlsFontColor,"font-size":Ol.controlsFontSize,"font-family":Ol.controlsFont,"font-style":"normal","font-weight":"normal","text-decoration":"none"}),x.draggable({containment:"parent"}),x.append(e()),x.append(t()),x.append(n()),x.append(o());var w=$("."+kt);w&&w.css({"text-align":"center","padding-top":"3px","padding-bottom":"5px","font-size":Ol.controlsFontSize,"font-family":Ol.controlsFont,"font-style":"italic","font-weight":"bold","text-decoration":"none"}),$("a").css({color:$l,"text-decoration":"none"}),$("."+Fn).controlgroup({direction:"horizontal",width:"120px"}),$("."+bn).controlgroup({direction:"vertical",width:"120px"}),x.append(l()),x.append(r()),x.append(s()),$("."+go).controlgroup({direction:"horizontal"}),x.append(i()),Ol.enableDownloads&&x.append(a())}var z=$("#"+gn);z&&(z.css({position:"absolute",left:Ol.controls1Left,top:Ol.controls1Top+ya,"text-align":"left",padding:"0.1em",opacity:"0.85","background-color":Ol.controlsBackgroundColor,color:Ol.controlsFontColor,"font-size":Ol.controlsFontSize,"font-family":Ol.controlsFont,"font-style":"normal","font-weight":"normal","text-decoration":"none"}),z.draggable({containment:"parent"}),Ol.enableNodeVisualizations&&Ml&&(z.append(d()),z.append(u()))),$("input:button").button().css({width:"26px","text-align":"center",outline:"none",margin:"0px","font-style":"normal","font-weight":"normal","text-decoration":"none"}),$("#"+Tn+", #"+Ln).css({width:"78px"}),$("#"+Tn+", #"+Ln+", #"+Pn+", #"+Rn+", #"+Vn).css({height:"16px"}),$("#"+Qn+", #"+eo+", #"+to+", #"+no).css({width:"16px"}),$("#"+Jo+", #"+tl).css({width:"72px"}),$("#"+Qo+", #"+Zo+", #"+el).css({width:"24px"}),$("#"+Ko+", #"+jo).css({width:"36px"}),$("#"+Jo+", #"+tl+", #"+Qo+", #"+Zo+", #"+el+", #"+Ko+", #"+jo).css({height:"16px"});var D=$("#"+bo);D&&D.css({width:"60px","margin-bottom":"3px"}),$(":radio").checkboxradio({icon:!1}),$(":checkbox").checkboxradio({icon:!1}),$("#"+Yn).keyup(ee),$("#"+Gn).keyup(te),$("#"+mn).click(ae),$("#"+yn).click(re),$("#"+vn).click(ie),$("#"+xn).click(se),$("#"+wn).click(ce),$("#"+Cn).click(de),$("#"+zn).click(ue),$("#"+Dn).click(fe),$("#"+En).click(he),$("#"+Sn).click(pe),$("#"+Nn).click(ge),$("#"+An).click(me),$("#"+Bn).click(ye),$("#"+kn).click(ve),$("#"+$n).click(Fe),$("#"+_n).click(be),$("#"+po).on("change",function(){var e=this.value;e&&e!=Lo?(ta=e,A(Vo,ga.labelColor[ta])):(ta=null,_(Vo)),C(),S(null,0)}),$("#"+uo).on("change",function(){var e=this.value;e&&e!=Lo?(Il.showExternalNodes||Il.showInternalNodes||null!=na||(Il.showExternalNodes=!0,qe(kn,!0)),oa=e,A(Po,ga.nodeFillColor[oa])):(oa=null,_(Po)),C(),S(null,0)}),$("#"+fo).on("change",function(){var e=this.value;e&&e!=Lo?(la=e,e!=Ro&&e!=To&&(A(Io,ga.nodeBorderColor[la]),Il.showExternalNodes||Il.showInternalNodes||null!=na||(Il.showExternalNodes=!0,qe(kn,!0)))):la=null,e!=Lo&&e!=Ro&&e!=To||_(Io),C(),S(null,0)}),$("#"+co).on("change",function(){var e=this.value;e&&e!=Lo?(na=e,B(Oo,ga.nodeShape[na])):(na=null,T(Oo)),C(),f(),S(null,0),S(null,0)}),$("#"+ho).on("change",function(){var e=this.value;e&&e!=Lo?(aa=e,k(Mo,ga.nodeSize[aa]),Il.showExternalNodes||Il.showInternalNodes||null!=na||(Il.showExternalNodes=!0,qe(kn,!0))):(aa=null,L(Mo)),C(),S(null,0)}),$("#"+Xn).slider({min:an,max:ln,step:un,value:Il.nodeSizeDefault,animate:"fast",slide:Ce,change:Ce}),$("#"+qn).slider({min:sn,max:rn,step:un,value:Il.branchWidthDefault,animate:"fast",slide:we,change:we}),$("#"+On).slider({min:dn,max:cn,step:un,value:Il.externalNodeFontSize,animate:"fast",slide:De,change:De}),$("#"+In).slider({min:dn,max:cn,step:un,value:Il.internalNodeFontSize,animate:"fast",slide:ze,change:ze}),$("#"+Mn).slider({min:dn,max:cn,step:un,value:Il.branchDataFontSize,animate:"fast",slide:Ee,change:Ee}),$("#"+Yn+", #"+Gn).button().off("keydown").off("mouseenter").off("mousedown").css({font:"inherit",color:"inherit","text-align":"left",outline:"none",cursor:"text",width:"38px"}),$("#"+oo+", #"+lo).button().off("keydown").off("mouseenter").off("mousedown").attr("disabled","disabled").css({font:"inherit",color:"inherit","text-align":"center",outline:"none",cursor:"text",width:"18px"}),$("#"+Tn).mousedown(function(){W(),ea=setInterval(W,jt)}).bind("mouseup mouseleave",function(){clearTimeout(ea)}),$("#"+Ln).mousedown(function(){G(),ea=setInterval(G,jt)}).bind("mouseup mouseleave",function(){clearTimeout(ea)}),$("#"+Rn).mousedown(function(){H(),ea=setInterval(H,jt)}).bind("mouseup mouseleave",function(){clearTimeout(ea)}),$("#"+Vn).mousedown(function(){Y(),ea=setInterval(Y,jt)}).bind("mouseup mouseleave",function(){clearTimeout(ea)}),$("#"+Qn).mousedown(function(){nt(),ea=setInterval(nt,jt)}).bind("mouseup mouseleave",function(){clearTimeout(ea)}),$("#"+eo).mousedown(function(){ot(),ea=setInterval(ot,jt)}).bind("mouseup mouseleave",function(){clearTimeout(ea)}),$("#"+to).mousedown(function(){lt(),ea=setInterval(lt,jt)}).bind("mouseup mouseleave",function(){clearTimeout(ea)}),$("#"+no).mousedown(function(){at(),ea=setInterval(at,jt)}).bind("mouseup mouseleave",function(){clearTimeout(ea)}),$("#"+Pn).mousedown(K),$("#"+Hn).mousedown(j),$("#"+Un).mousedown(J),$("#"+Wn).mousedown(Z),$("#"+mo).click(Se),$("#"+yo).click(Ne),$("#"+vo).click(Ae),$("#"+Fo).click(Be),$("#"+Kn).mousedown(ne),$("#"+jn).mousedown(oe),$("#"+Jo).mousedown(function(){ke(2),ea=setInterval(ke,Jt)}).bind("mouseup mouseleave",function(){clearTimeout(ea)}),$("#"+tl).mousedown(function(){$e(2),ea=setInterval($e,Jt)}).bind("mouseup mouseleave",function(){clearTimeout(ea)}),$("#"+Zo).mousedown(function(){Te(2),ea=setInterval(Te,Jt)}).bind("mouseup mouseleave",function(){clearTimeout(ea)}),$("#"+el).mousedown(function(){_e(2),ea=setInterval(_e,Jt)}).bind("mouseup mouseleave",function(){clearTimeout(ea)}),$("#"+jo).click(Re),$("#"+Ko).click(Ve),$("#"+Qo).click(Pe),D&&D.mousedown(xe),$("#"+ro).select().css({font:"inherit",color:"inherit"}),$("#"+xo).select().css({font:"inherit",color:"inherit"}),$("#"+ro).on("change",function(){var e=$("#"+ro);if(e){var t=e.val();t&&st(t)}}),$("#"+po).select().css({font:"inherit",color:"inherit"}),$("#"+uo).select().css({font:"inherit",color:"inherit"}),$("#"+fo).select().css({font:"inherit",color:"inherit"}),$("#"+co).select().css({font:"inherit",color:"inherit"}),$("#"+ho).select().css({font:"inherit",color:"inherit"}),$(document).keyup(function(e){e.altKey?e.keyCode===dl?J():e.keyCode===ul?j():e.keyCode===fl?Z():e.keyCode===yl||e.keyCode===vl||e.keyCode===Fl||e.keyCode===bl?K():e.keyCode===hl?Qe():e.keyCode===ml&&toggleAlignPhylogram():e.keyCode===bl?K():e.keyCode===cl&&Q()}),$(document).keydown(function(e){e.altKey&&(e.keyCode===xl?W(en):e.keyCode===wl?G(tn):e.keyCode===Cl?Y(tn):e.keyCode===zl?H(en):e.keyCode===Dl||e.keyCode===Sl?e.shiftKey?We():(W(en),H(en)):e.keyCode===El||e.keyCode===Nl?e.shiftKey?Ye():(G(tn),Y(tn)):e.keyCode===pl?nt():e.keyCode===gl&&ot()),e.keyCode===Al?We():e.keyCode===Bl&&Ye()}),$(document).on("mousewheel DOMMouseScroll",function(e){if(e.shiftKey){if(e.originalEvent){var t=e.originalEvent;t.detail>0||t.wheelDelta<0?e.ctrlKey?Ye():e.altKey?Y(tn):G(tn):e.ctrlKey?We():e.altKey?H(en):W(en)}return!1}})}function Ke(){et(),qe(xn,Il.showNodeName),qe(wn,Il.showTaxonomy),qe(Cn,Il.showSequence),qe(zn,Il.showConfidenceValues),qe(Dn,Il.showBranchLengthValues),qe(En,Il.showNodeEvents),qe(Sn,Il.showBranchEvents),qe(Nn,Il.showInternalLabels),qe(An,Il.showExternalLabels),qe(Bn,Il.showInternalNodes),qe(kn,Il.showExternalNodes),qe($n,Il.showNodeVisualizations),qe(_n,Il.showBranchVisualizations),je(),Je()}function je(){if($("select#"+uo).append($("<option>").val(Lo).html("default")),$("select#"+fo).append($("<option>").val(Lo).html("default")),$("select#"+fo).append($("<option>").val(To).html("none")),$("select#"+fo).append($("<option>").val(Ro).html("same as fill")),$("select#"+co).append($("<option>").val(Lo).html("default")),$("select#"+ho).append($("<option>").val(Lo).html("default")),$("select#"+po).append($("<option>").val(Lo).html("default")),ga){if(ga.labelColor)for(var e in ga.labelColor)ga.labelColor.hasOwnProperty(e)&&$("select#"+po).append($("<option>").val(e).html(e));if(ga.nodeShape)for(var e in ga.nodeShape)ga.nodeShape.hasOwnProperty(e)&&$("select#"+co).append($("<option>").val(e).html(e));if(ga.nodeFillColor)for(var e in ga.nodeFillColor)ga.nodeFillColor.hasOwnProperty(e)&&$("select#"+uo).append($("<option>").val(e).html(e));if(ga.nodeBorderColor)for(var e in ga.nodeBorderColor)ga.nodeBorderColor.hasOwnProperty(e)&&$("select#"+fo).append($("<option>").val(e).html(e));if(ga.nodeSize)for(var e in ga.nodeSize)ga.nodeSize.hasOwnProperty(e)&&$("select#"+ho).append($("<option>").val(e).html(e))}}function Je(){Il.searchUsesRegex===!0&&(Il.searchIsPartial=!0),Il.searchIsPartial===!1&&(Il.searchUsesRegex=!1),Il.searchNegateResult=!1,qe(mo,Il.searchIsCaseSensitive),qe(yo,!Il.searchIsPartial),qe(vo,Il.searchUsesRegex),qe(Fo,Il.searchNegateResult)}function Ze(e,t){function n(e){if(e.children){var l=e.children,a=l.length;if(2==a){var r=forester.calcSumOfAllExternalDescendants(l[0]),i=forester.calcSumOfAllExternalDescendants(l[1]);if(r!==i&&r<i===t){o=!0;var s=l[0];l[0]=l[1],l[1]=s}}for(var c=0;c<a;++c)n(l[c])}}var o=!1;n(e),o||(t=!t,n(e))}function Qe(){Il.phylogram&&!Il.alignPhylogram?Il.alignPhylogram=!0:Il.phylogram&&Il.alignPhylogram?(Il.phylogram=!1,Il.alignPhylogram=!1):Il.phylogram||Il.alignPhylogram||(Il.phylogram=!0),et(),S(null,0)}function et(){Me(mn,Il.phylogram&&!Il.alignPhylogram),Me(vn,!Il.phylogram&&!Il.alignPhylogram),Me(yn,Il.alignPhylogram&&Il.phylogram)}function tt(e){forester.preOrderTraversal(e,function(e){e._children&&(e.children=e._children,e._children=null),e[hn]&&(e[hn]=void 0)})}function nt(){da=-1,ua=-1,ut(),_l&&Pl&&ha>2&&(ca<=1?(ca=forester.calcMaxDepth(_l),tt(_l)):(--ca,forester.collapseToDepth(_l,ca))),S(null,0)}function ot(){if(da=-1,ua=-1,ut(),_l&&Pl&&ha>2){var e=forester.calcMaxDepth(_l);ca>=e?ca=1:(tt(_l),++ca),forester.collapseToDepth(_l,ca)}S(null,0)}function lt(){da=-1,ca=-1,ut(),_l&&Pl&&ha>2&&(ua<=fa.min&&(ua=fa.max),ua-=fa.step,forester.collapseToBranchLength(_l,ua)),S(null,0)}function at(){da=-1,ca=-1,ut(),_l&&Pl&&ha>2&&((ua>=fa.max||ua<0)&&(ua=fa.min),ua+=fa.step,ua>=fa.max?tt(_l):forester.collapseToBranchLength(_l,ua)),S(null,0)}function rt(){var e=mt();$("#"+oo).val(" "+e)}function it(){var e=yt();$("#"+lo).val(e)}function st(e){da=-1,ca=-1,ua=-1,e===io?dt(_l,null,hn):e===so?tt(_l):dt(_l,e,hn),S(null,0)}function ct(e,t){forester.preOrderTraversalAll(e,function(e){e[t]&&(e[t]=void 0)})}function dt(e,t,n){tt(e),t&&t.length>0?forester.preOrderTraversalAll(e,function(e){if(e.children&&!e._children&&e.children.length>1){var o=forester.getOneDistinctNodePropertyValue(e,t);null!=o&&(forester.collapse(e),n&&(e[n]="["+t+"] "+o))}}):forester.preOrderTraversalAll(e,function(e){if(e.children&&!e._children&&e.children.length>1){var t=forester.getOneDistinctTaxonomy(e);null!=t&&(forester.collapse(e),n&&(e[n]=t))}})}function ut(){var e=$("#"+ro);if(e){var t=e.val();t!=so&&(e.val(so),ct(_l,hn))}}function ft(){Vl&&Vl.length>0?gt($("#"+Hn)):pt($("#"+Hn)),forester.isHasCollapsedNodes(_l)?gt($("#"+Wn)):pt($("#"+Wn));var e=null;if(Wl&&!jl){if(e=$("#"+Kn)){e.prop("disabled",!1),Wl.size<1?(e.css("background",""),e.css("color","")):(e.css("background",Il.found0ColorDefault),e.css("color","#ffffff"));var t=1===Wl.size?"node":"nodes";e.prop("title","found "+Wl.size+" "+t+" [click to "+Jn+"]")}}else e=$("#"+Kn),e&&(e.prop("disabled",!0),e.css("background",Ol.controlsBackgroundColor),e.css("color",""),e.prop("title",Jn));if(Yl&&!Jl){if(e=$("#"+jn)){e.prop("disabled",!1),Yl.size<1?(e.css("background",""),e.css("color","")):(e.css("background",Il.found1ColorDefault),e.css("color","#ffffff"));var n=1===Yl.size?"node":"nodes";e.prop("title","found "+Yl.size+" "+n+" [click to "+Zn+"]")}}else e=$("#"+jn),e&&(e.prop("disabled",!0),e.css("background",Ol.controlsBackgroundColor),e.css("color",""),e.prop("title",Zn))}function ht(){var e=$("#"+Ko);e&&(xa?(e.css("background",$l),e.css("color","#ffffff")):(e.css("background",""),e.css("color",""))),xa&&(va[Vo]||Il.showNodeVisualizations&&(va[Po]||va[Io]||Fa[Oo]||ba[Mo]))?(gt($("#"+jo)),gt($("#"+Jo)),gt($("#"+tl)),gt($("#"+Zo)),gt($("#"+el)),gt($("#"+Qo))):(pt($("#"+jo)),pt($("#"+Jo)),pt($("#"+tl)),pt($("#"+Zo)),pt($("#"+el)),pt($("#"+Qo)))}function pt(e){e&&(e.prop("disabled",!0),e.css("background",Ol.controlsBackgroundColor))}function gt(e){e&&(e.prop("disabled",!1),e.css("background",""))}function mt(){return Pl&&_l?ha<3?"off":ca<0?(ca=forester.calcMaxDepth(_l),"off"):ca==forester.calcMaxDepth(_l)?"off":ca:""}function yt(){return Pl&&_l?(fa.min||bt(),ha<3?"off":ua<=fa.min?"off":ua>=fa.max?"off":ua):""}function vt(){ca=-1}function Ft(){
da=-1}function bt(){if(ua=-1,fa.min=Number.MAX_VALUE,fa.max=0,_l){forester.removeMaxBranchLength(_l);var e=forester.calcBranchLengthSimpleStatistics(_l);fa.min=e.min,fa.max=e.max,fa.max=.25*(3*fa.max+fa.min);var t=e.n<200?e.n/4:50;fa.step=(fa.max-fa.min)/t}}function xt(){var e=ma.replace("#",""),t=document.getElementById(e),n=t.querySelector("svg"),o=null;return"undefined"!=typeof window.XMLSerializer?o=(new XMLSerializer).serializeToString(n):"undefined"!=typeof n.xml&&(o=n.xml),o}function wt(e){e===wo?St():e===Co?Dt():e===Do?zt():e===zo?Ct():e===Eo&&Et()}function Ct(){var e=phyloXml.toPhyloXML(_l,9);saveAs(new Blob([e],{type:"application/xml"}),Il.nameForPhyloXmlDownload)}function zt(){var e=forester.toNewHampshire(_l,9,!0,Ol.nhExportWriteConfidences);saveAs(new Blob([e],{type:"application/txt"}),Il.nameForNhDownload)}function Dt(){var e=xt();saveAs(new Blob([decodeURIComponent(encodeURIComponent(e))],{type:"application/svg+xml"}),Il.nameForSvgDownload)}function Et(){}function St(){var e=xt(),t=document.createElement("canvas");canvg(t,e),t.toBlob(function(e){saveAs(e,Il.nameForPngDownload)})}var Nt="0.85",At="https://docs.google.com/document/d/16PjoaNeNTWPUNVGcdYukP6Y1G35PFhq39OiIMmD03U8",Bt="Archaeopteryx.js",kt="progname",$t=750,_t=30,Tt=800,Lt=600,Rt=20,Vt=20,Pt=120,It=20,Ot="9px",Mt="#ff5050",qt="Times",Xt="#e0e0e0",Ut="#ff0000",Ht="#00ff00",Wt="#ffff00",Yt=!1,Gt=4,Kt=2,jt=200,Jt=150,Zt=1.1,Qt=1/Zt,en=1.05,tn=1/en,nn="#ffffff",on="#606060",ln=9,an=1,rn=9,sn=.5,cn=26,dn=2,un=.5,fn="overlay",hn="collapsed_spec_label",pn="controls0",gn="controls1",mn="phy_b",yn="phya_b",vn="cla_b",Fn="phy_cla_g",bn="display_data_g",xn="nn_cb",wn="tax_cb",Cn="seq_cb",zn="conf_cb",Dn="bl_cb",En="nevts_cb",Sn="brevts_cb",Nn="intl_cb",An="extl_cb",Bn="intn_cb",kn="extn_cb",$n="nodevis_cb",_n="branchvis_cb",Tn="zoomout_y",Ln="zoomin_y",Rn="zoomin_x",Vn="zoomout_x",Pn="zoomtofit",In="intfs_sl",On="entfs_sl",Mn="bdfs_sl",qn="bw_sl",Xn="ns_sl",Un="ord_b",Hn="ret_b",Wn="unc_b",Yn="sf0",Gn="sf1",Kn="reset_s_a",jn="reset_s_b",Jn="reset (remove) search result A",Zn="reset (remove) search result B",Qn="decr_dcl",eo="incr_dcl",to="decr_blcl",no="incr_blcl",oo="depth_col_label",lo="bl_col_label",ao="node_data_dialog",ro="coll_by_feat_sel",io="Species",so="off",co="nshapes_menu",uo="nfcolors_menu",fo="nbcolors_menu",ho="nsizes_menu",po="lcs_menu",go="search_opts_g",mo="so_cs_cb",yo="so_cto_cb",vo="so_regex_cb",Fo="so_neg_cb",bo="dl_b",xo="exp_f_sel",wo="PNG",Co="SVG",zo="phyloXML",Do="Newick",Eo="PDF",So="archaeopteryx-js.nh",No="archaeopteryx-js.xml",Ao="archaeopteryx-js.png",Bo="archaeopteryx-js.svg",ko="aptx:branch_event",$o="xsd:string",_o="parent_branch",To="none",Lo="default",Ro="sameasfill",Vo="legendLabelColor",Po="legendNodeFillColor",Io="legendNodeBorderColor",Oo="legendNodeShape",Mo="legendNodeSize",qo="ordinal",Xo="linear",Uo="horizontal",Ho="vertical",Wo=160,Yo=30,Go=Ho,Ko="legends_show",jo="legends_horizvert",Jo="legends_mup",Zo="legends_mleft",Qo="legends_rest",el="legends_mright",tl="legends_mdown",nl="col_pick",ol="#000000",ll="#808080",al="colorPickerLabel",rl="legend",il="legendLabel",sl="legendDescription",cl=27,dl=79,ul=82,fl=85,hl=80,pl=65,gl=83,ml=76,yl=67,vl=46,Fl=8,bl=36,xl=38,wl=40,Cl=37,zl=39,Dl=187,El=189,Sl=107,Nl=109,Al=33,Bl=34,kl="ArchaeopteryxJS: WARNING",$l="#2590FD",_l=null,Tl=null,Ll=null,Rl=null,Vl=[],Pl=null,Il=null,Ol=null,Ml=null,ql=0,Xl=0,Ul=null,Hl=null,Wl=new Set,Yl=new Set,Gl=0,Kl=0,jl=!0,Jl=!0,Zl=0,Ql=0,ea=0,ta=null,na=null,oa=null,la=null,aa=null,ra=0,ia=0,sa=null,ca=-1,da=-1,ua=-1,fa={},ha=0,pa=null,ga=null,ma=null,ya=0,va={},Fa={},ba={},xa=!0,wa=!1,Ca=null,za=new Set,Da=null,Ea=function(e){return Il.showNodeEvents&&e.events&&e.children&&(e.events.duplications||e.events.speciations)?Il.nodeSizeDefault:Il.nodeSizeDefault>0&&e.parent&&(!Il.showNodeVisualizations||!e.hasVis)&&(e.children&&Il.showInternalNodes||!e._children&&!e.children&&Il.showExternalNodes)||Il.phylogram&&e.parent&&!e.parent.parent&&(!e.branch_length||e.branch_length<=0)?Oa(e,.05):0},Sa=function(e){return e.target.width?e.target.width:Il.branchWidthDefault},Na=function(e){if(e.target.color){var t=e.target.color;return"rgb("+t.red+","+t.green+","+t.blue+")"}return Il.branchColorDefault},Aa=function(e){var t=V(e);if(null!==t)return t;if(Il.showNodeEvents&&e.events&&e.children&&(e.events.speciations||e.events.duplications)){var n=N(e.events);return null!==n?n:Il.backgroundColorDefault}return La(e)},Ba=function(e){var t=V(e);if(null!==t)return t;if(Il.showNodeEvents&&e.events&&e.children){var n=N(e.events);if(null!==n)return n}else{if(Il.showNodeVisualizations)return Va(e);if(e.color){var o=e.color;return"rgb("+o.red+","+o.green+","+o.blue+")"}}return Il.branchColorDefault},ka=function(e){var t=R(e);return t?t:(t=_a(e),t?t:e.color?"rgb("+e.color.red+","+e.color.green+","+e.color.blue+")":Il.branchColorDefault)},$a=function(e){var t=V(e);if(null!==t)return t;if(ta){var n=Pa(e);if(n)return n}if(e.color){var o=e.color;return"rgb("+o.red+","+o.green+","+o.blue+")"}return Il.labelColorDefault},_a=function(e,t){if(t&&t!=Il.branchColorDefault)return t;if(ta){var t=Ia(e);if(t)return t}if(e.color){var n=e.color;return"rgb("+n.red+","+n.green+","+n.blue+")"}return Il.labelColorDefault},Ta=function(e){function t(t,o){if(t.mappingFn){if(t.mappingFn(o))return n(e,t.mappingFn(o))}else if(t.mapping[o])return n(e,t.mapping[o]);return null}function n(e,t){return e.hasVis=!0,d3.svg.symbol().type(t).size(Oa(e))()}if(na&&ga&&!e._children&&ga.nodeShape&&ga.nodeShape[na]){var o=ga.nodeShape[na];if(o.field){var l=e[o.field];if(l){if(!o.isRegex)return t(o,l);for(var a in o.mapping)if(o.mapping.hasOwnProperty(a)){var r=new RegExp(a);if(r&&l.search(r)>-1)return t(o,a)}}}else if(o.cladePropertyRef&&e.properties&&e.properties.length>0)for(var i=o.cladePropertyRef,s=e.properties.length,c=0;c<s;++c){var d=e.properties[c];if(d.value&&d.ref===i)return t(o,d.value)}}return null},La=function(e){if(oa&&ga&&!e._children&&ga.nodeFillColor&&ga.nodeFillColor[oa]){var t=ga.nodeFillColor[oa],n=Ra(e,t);if(n)return n}return Il.backgroundColorDefault},Ra=function(e,t){function n(e,t){return e.mappingFn?e.mappingFn(t):e.mapping[t]}if(t.field){var o=e[t.field];if(o){if(!t.isRegex)return n(t,o);for(var l in t.mapping)if(t.mapping.hasOwnProperty(l)){var a=new RegExp(l);if(a&&o.search(a)>-1)return n(t,l)}}}else if(t.cladePropertyRef&&e.properties&&e.properties.length>0)for(var r=t.cladePropertyRef,i=e.properties.length,s=0;s<i;++s){var c=e.properties[s];if(c.value&&c.ref===r)return n(t,c.value)}return null},Va=function(e){if(!la)return Il.branchColorDefault;if(la===Ro)return La(e);if(la===To)return Il.backgroundColorDefault;if(ga&&!e._children&&ga.nodeBorderColor&&ga.nodeBorderColor[la]){var t=ga.nodeBorderColor[la],n=Ra(e,t);if(n)return n}return Il.branchColorDefault},Pa=function(e){if(ta&&ga&&!e._children&&ga.labelColor&&ga.labelColor[ta]){var t=ga.labelColor[ta],n=Ra(e,t);if(n)return n}return Il.labelColorDefault},Ia=function(e){var t=null,n=!0;if(ta&&ga&&ga.labelColor&&ga.labelColor[ta]){var o=ga.labelColor[ta];forester.preOrderTraversalAll(e,function(e){if(forester.isHasNodeData(e)){var l=Ra(e,o);l?null==t?t=l:t!=l&&(n=!1):n=!1}})}return n===!1?null:t},Oa=function(e,t){function n(e,t,n){var o;return o=e.mappingFn?e.mappingFn(t):e.mapping[t],o?n?n*o*Il.nodeSizeDefault:o*Il.nodeSizeDefault:null}if(Il.showNodeVisualizations&&aa&&ga&&!e._children&&ga.nodeSize&&ga.nodeSize[aa]){var o,l=ga.nodeSize[aa];if(l.field){var a=e[l.field];if(a)if(l.isRegex){for(var r in l.mapping)if(l.mapping.hasOwnProperty(r)){var i=new RegExp(r);if(i&&a.search(i)>-1&&(o=n(l,r,t)))return o}}else if(o=n(l,a,t))return o}else if(l.cladePropertyRef&&e.properties&&e.properties.length>0)for(var s=l.cladePropertyRef,c=e.properties.length,d=0;d<c;++d){var u=e.properties[d];if(u.ref===s&&u.value&&(o=n(l,u.value,t)))return o}}return t?Il.nodeSizeDefault:2*Il.nodeSizeDefault*Il.nodeSizeDefault},Ma=function(e){function t(e,t){return t&&t.length>0&&(e.length>0?e+=" "+t:e=t),e}function n(e,t){return t&&t.length>0&&(e.length>0?e+=" ("+t+")":e="("+t+")"),e}function o(e,t){return t&&t.length>0&&(e.length>0?e+=" ["+t+"]":e="["+t+"]"),e}if(!Il.showExternalLabels&&!e.children&&!e._children)return null;if(!Il.showInternalLabels&&(e.children||e._children))return null;var l="";if(Il.showNodeName&&(l=t(l,e.name)),Il.showTaxonomy&&e.taxonomies&&e.taxonomies.length>0){var a=e.taxonomies[0];if(Il.showTaxonomyCode&&(l=t(l,a.code)),Il.showTaxonomyScientificName&&(l=t(l,a.scientific_name)),Il.showTaxonomyCommonName&&(l=n(l,a.common_name)),Il.showTaxonomyRank&&(l=n(l,a.rank)),Il.showTaxonomySynonyms&&a.synonyms&&a.synonyms.length>0)for(var r=a.synonyms,i=0;i<r.length;++i)l=o(l,r[i])}if(Il.showSequence&&e.sequences&&e.sequences.length>0){var s=e.sequences[0];Il.showSequenceSymbol&&(l=t(l,s.symbol)),Il.showSequenceName&&(l=t(l,s.name)),Il.showSequenceGeneSymbol&&(l=n(l,s.gene_name)),Il.showSequenceAccession&&s.accession&&s.accession.value&&(l=n(l,s.accession.value))}if(Il.showDistributions&&e.distributions&&e.distributions.length>0)for(var c=e.distributions,d=0;i<c.length;++d)l=o(l,c[d].desc);return l},qa=function(e,t){if(!e.hide){var n,o;t.length>1&&(n=t[0],o=t[t.length-1]);var l=null;if(n&&o){var a=Ma(n),r=Ma(o);a&&r&&(l=a.substring(0,Il.collapasedLabelLength)+" ... "+r.substring(0,Il.collapasedLabelLength)+" ["+t.length+"]",Gl>0&&Kl&&(l+=" ["+Gl+"/"+Kl+"]")),e[hn]&&(l=l?e[hn]+": "+l:e[hn])}return l}},Xa=function(e){if(e.branch_length){if(Il.phylogram&&Il.minBranchLengthValueToShow&&e.branch_length<Il.minBranchLengthValueToShow)return;return+e.branch_length.toFixed(Gt)}},Ua=function(e){if(e.confidences&&e.confidences.length>0){var t=e.confidences,n=t.length;if(Il.minConfidenceValueToShow){for(var o=!1,l=0;l<n;++l)if(t[l].value>=Il.minConfidenceValueToShow){o=!0;break}if(!o)return}if(1!=n){for(var a="",r=0;r<n;++r)t[r].value&&(r>0&&(a+="/"),a+=+t[r].value.toFixed(Kt));return a}if(t[0].value)return+t[0].value.toFixed(Kt)}},Ha=function(e){if(e.properties&&e.properties.length>0){for(var t=e.properties.length,n=null,o=0;o<t;++o)e.properties[o].ref===ko&&e.properties[o].datatype===$o&&e.properties[o].applies_to===_o&&(null===n?n=e.properties[o].value:n+=" | "+e.properties[o].value);if(null!==n)return n}},Wa=function(e){return"M"+e.source.y+","+e.source.x+"V"+e.target.x+"H"+e.target.y},Ya=function(e){if(Il.phylogram){var t=e.y+5;e._children&&(t+=e.avg);var n=e.x,o=e.y-Hl(e.distToRoot)+pa;if(o-t>5)return"M"+t+","+n+"L"+o+","+n}};e.launch=function(e,t,l,a,i){if(Pl=t,Ul=d3.behavior.zoom().scaleExtent([.1,10]).on("zoom",n),sa=forester.collectBasicTreeProperties(Pl),i&&(Ml=i),a.readSimpleCharacteristics&&forester.moveSimpleCharacteristicsToProperties(Pl),P(l),I(a),a.enableNodeVisualizations){var s=forester.collectProperties(Pl,"node",!1);r(s)}ma=e,Ge(sa),(a.enableNodeVisualizations||a.enableBranchVisualizations)&&d3.select(window).on("mousedown",M),Ll=d3.select(e).append("svg").attr("width",Zl).attr("height",Ql).attr("class",fn).style("background-color",Il.backgroundColorDefault).style("border",function(){return Ol.border?Ol.border:""}).call(Ul),Tl=Ll.append("g"),Rl=d3.layout.cluster().size([Ql,Zl]),Rl.clickEvent=U(t),q(),_l=t,_l.x0=Ql/2,_l.y0=0,Ke(),S(null,0),o(_l,Ol.rootOffset)},e.parsePhyloXML=function(e){return phyloXml.parse(e,{trim:!0,normalize:!0})[0]},e.parseNewHampshire=function(e){return forester.parseNewHampshire(e)},$("html").click(function(e){var t=e.target.getAttribute("class");"nodeCircleOptions"!==t&&X(),t===fn&&wa===!0&&C()}),"undefined"!=typeof module&&module.exports&&!global.xmldocAssumeBrowser?module.exports.archaeopteryx=e:"undefined"!=typeof window?window.archaeopteryx=e:this.archaeopteryx=e}();