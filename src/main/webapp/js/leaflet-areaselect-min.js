L.AreaSelect=L.Class.extend({includes:L.Mixin.Events,options:{width:200,height:300,keepAspectRatio:!1},initialize:function(t){L.Util.setOptions(this,t),this._width=this.options.width,this._height=this.options.height},addTo:function(t){return this.map=t,this._createElements(),this._render(),this},getBounds:function(){var t=this.map.getSize(),e=new L.Point,i=new L.Point;i.x=Math.round((t.x-this._width)/2),e.y=Math.round((t.y-this._height)/2),e.x=t.x-i.x,i.y=t.y-e.y;var n=this.map.containerPointToLatLng(i),h=this.map.containerPointToLatLng(e);return new L.LatLngBounds(n,h)},remove:function(){this.map.off("moveend",this._onMapChange),this.map.off("zoomend",this._onMapChange),this.map.off("resize",this._onMapResize),this._container.parentNode.removeChild(this._container)},setDimensions:function(t){t&&(this._height=parseInt(t.height)||this._height,this._width=parseInt(t.width)||this._width,this._render(),this.fire("change"))},_createElements:function(){this._container||(this._container=L.DomUtil.create("div","leaflet-areaselect-container",this.map._controlContainer),this._topShade=L.DomUtil.create("div","leaflet-areaselect-shade leaflet-control",this._container),this._bottomShade=L.DomUtil.create("div","leaflet-areaselect-shade leaflet-control",this._container),this._leftShade=L.DomUtil.create("div","leaflet-areaselect-shade leaflet-control",this._container),this._rightShade=L.DomUtil.create("div","leaflet-areaselect-shade leaflet-control",this._container),this._nwHandle=L.DomUtil.create("div","leaflet-areaselect-handle leaflet-control",this._container),this._swHandle=L.DomUtil.create("div","leaflet-areaselect-handle leaflet-control",this._container),this._neHandle=L.DomUtil.create("div","leaflet-areaselect-handle leaflet-control",this._container),this._seHandle=L.DomUtil.create("div","leaflet-areaselect-handle leaflet-control",this._container),this._setUpHandlerEvents(this._nwHandle),this._setUpHandlerEvents(this._neHandle,-1,1),this._setUpHandlerEvents(this._swHandle,1,-1),this._setUpHandlerEvents(this._seHandle,-1,-1),this.map.on("moveend",this._onMapChange,this),this.map.on("zoomend",this._onMapChange,this),this.map.on("resize",this._onMapResize,this),this.fire("change"))},_setUpHandlerEvents:function(t,e,i){function n(a){function o(t){if(h.options.keepAspectRatio){var n=(h._height>=h._width?_.y:_.y*(1/d))-30;h._height+=2*(r-t.originalEvent.pageY)*i,h._height=Math.max(30,h._height),h._height=Math.min(n,h._height),h._width=h._height*d}else h._width+=2*(l-t.originalEvent.pageX)*e,h._height+=2*(r-t.originalEvent.pageY)*i,h._width=Math.max(30,h._width),h._height=Math.max(30,h._height),h._width=Math.min(_.x-30,h._width),h._height=Math.min(_.y-30,h._height);l=t.originalEvent.pageX,r=t.originalEvent.pageY,h._render()}function s(e){h.map.dragging.enable(),L.DomEvent.removeListener(h.map,"mouseup",s),L.DomEvent.removeListener(h.map,"mousemove",o),L.DomEvent.addListener(t,"mousedown",n),h.fire("change")}a.stopPropagation(),h.map.dragging.disable(),L.DomEvent.removeListener(this,"mousedown",n);var l=a.pageX,r=a.pageY,d=h._width/h._height,_=h.map.getSize();L.DomEvent.addListener(h.map,"mousemove",o),L.DomEvent.addListener(h.map,"mouseup",s)}e=e||1,i=i||1;var h=this;L.DomEvent.addListener(t,"mousedown",n)},_onMapResize:function(){this._render()},_onMapChange:function(){this.fire("change")},_render:function(){function t(t,e){t.style.width=e.width+"px",t.style.height=e.height+"px",t.style.top=e.top+"px",t.style.left=e.left+"px",t.style.bottom=e.bottom+"px",t.style.right=e.right+"px"}var e=this.map.getSize(),i=Math.round(this._nwHandle.offsetWidth/2),n=Math.round((e.y-this._height)/2),h=Math.round((e.x-this._width)/2);t(this._topShade,{width:e.x,height:n,top:0,left:0}),t(this._bottomShade,{width:e.x,height:n,bottom:0,left:0}),t(this._leftShade,{width:h,height:e.y-2*n,top:n,left:0}),t(this._rightShade,{width:h,height:e.y-2*n,top:n,right:0}),t(this._nwHandle,{left:h-i,top:n-7}),t(this._neHandle,{right:h-i,top:n-7}),t(this._swHandle,{left:h-i,bottom:n-7}),t(this._seHandle,{right:h-i,bottom:n-7})}}),L.areaSelect=function(t){return new L.AreaSelect(t)};